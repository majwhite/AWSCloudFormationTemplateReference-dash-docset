<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="aws-resource-ecs-clustercapacityproviderassociations">AWS::ECS::ClusterCapacityProviderAssociations</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The <code class="code">AWS::ECS::ClusterCapacityProviderAssociations</code> resource associates one
                                    or more capacity providers and a default capacity provider strategy with a
                                    cluster.
                                 </p>
                                 <h2 id="aws-resource-ecs-clustercapacityproviderassociations-syntax">Syntax</h2>
                                 <p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h3 id="aws-resource-ecs-clustercapacityproviderassociations-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  &quot;Type&quot; : &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;,
  &quot;Properties&quot; : <span>{</span>
      &quot;<a href="#cfn-ecs-clustercapacityproviderassociations-capacityproviders">CapacityProviders</a>&quot; : <code class="replaceable">[ String, ... ]</code>,
      &quot;<a href="#cfn-ecs-clustercapacityproviderassociations-cluster">Cluster</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy">DefaultCapacityProviderStrategy</a>&quot; : <code class="replaceable">[ <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a>, ... ]</code>
    }
}
</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h3 id="aws-resource-ecs-clustercapacityproviderassociations-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::ECS::ClusterCapacityProviderAssociations
Properties: 
  <a href="#cfn-ecs-clustercapacityproviderassociations-capacityproviders">CapacityProviders</a>: <code class="replaceable">
    - String</code>
  <a href="#cfn-ecs-clustercapacityproviderassociations-cluster">Cluster</a>: <code class="replaceable">String</code>
  <a href="#cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy">DefaultCapacityProviderStrategy</a>: <code class="replaceable">
    - <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a></code>
</code></pre></div>
                                 <h2 id="aws-resource-ecs-clustercapacityproviderassociations-properties">Properties</h2>
                                 <div class="variablelist">
                                    <dl>
                                       <dt><a id="cfn-ecs-clustercapacityproviderassociations-capacityproviders"></a><span class="term"><code class="code">CapacityProviders</code></span></dt>
                                       <dd>
                                          
                                          <p>The capacity providers to associate with the cluster.</p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: List of String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-ecs-clustercapacityproviderassociations-cluster"></a><span class="term"><code class="code">Cluster</code></span></dt>
                                       <dd>
                                          
                                          <p>The cluster the capacity provider association is the target of.</p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                       <dt><a id="cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy"></a><span class="term"><code class="code">DefaultCapacityProviderStrategy</code></span></dt>
                                       <dd>
                                          
                                          <p>The default capacity provider strategy to associate with the cluster.</p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: List of <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                    </dl>
                                 </div>
                                 <h2 id="aws-resource-ecs-clustercapacityproviderassociations-return-values">Return values</h2>
                                 <h3 id="aws-resource-ecs-clustercapacityproviderassociations-return-values-ref">Ref</h3>
                                 <p>When you pass the logical ID of this resource to the intrinsic <code class="code">Ref</code> function, <code class="code">Ref</code> returns the cluster name.
                                 </p>
                                 <h2 id="aws-resource-ecs-clustercapacityproviderassociations--examples">Examples</h2>
                                 <p></p>
                                 <h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider.">Creating a cluster capacity provider association using an Auto Scaling group capacity
                                    provider.
                                 </h3>
                                 <p>The following example creates a cluster, two Auto Scaling group capacity
                                    providers, and the cluster capacity provider association that facilitates the
                                    association between them. The Auto Scaling groups the capacity providers use
                                    must already be created and the Amazon Resource Name (ARN) of each Auto Scaling
                                    group must be specified as parameters.
                                 </p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider.--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
    &quot;Parameters&quot;: <span>{</span>
        &quot;AutoScalingGroupArn1&quot;: <span>{</span>
            &quot;Type&quot;: &quot;String&quot;
        },
        &quot;AutoScalingGroupArn2&quot;: <span>{</span>
            &quot;Type&quot;: &quot;String&quot;
        }
    },
    &quot;Resources&quot;: <span>{</span>
        &quot;CapacityProvider1&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::CapacityProvider&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AutoScalingGroupProvider&quot;: <span>{</span>
                    &quot;AutoScalingGroupArn&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;AutoScalingGroupArn1&quot;
                    },
                    &quot;ManagedScaling&quot;: <span>{</span>
                        &quot;Status&quot;: &quot;ENABLED&quot;
                    },
                    &quot;ManagedTerminationProtection&quot;: &quot;DISABLED&quot;
                }
            }
        },
        &quot;CapacityProvider2&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::CapacityProvider&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AutoScalingGroupProvider&quot;: <span>{</span>
                    &quot;AutoScalingGroupArn&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;AutoScalingGroupArn2&quot;
                    },
                    &quot;ManagedScaling&quot;: <span>{</span>
                        &quot;Status&quot;: &quot;ENABLED&quot;
                    },
                    &quot;ManagedTerminationProtection&quot;: &quot;DISABLED&quot;
                }
            }
        },
        &quot;Cluster&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::Cluster&quot;
        },
        &quot;ClusterCPAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;Cluster&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;Cluster&quot;
                },
                &quot;CapacityProviders&quot;: [
                    <span>{</span>
                        &quot;Ref&quot;: &quot;CapacityProvider1&quot;
                    },
                    <span>{</span>
                        &quot;Ref&quot;: &quot;CapacityProvider2&quot;
                    }
                ],
                &quot;DefaultCapacityProviderStrategy&quot;: [
                    <span>{</span>
                        &quot;Base&quot;: 2,
                        &quot;Weight&quot;: 6,
                        &quot;CapacityProvider&quot;: <span>{</span>
                            &quot;Ref&quot;: &quot;CapacityProvider1&quot;
                        }
                    },
                    <span>{</span>
                        &quot;Base&quot;: 0,
                        &quot;Weight&quot;: 10,
                        &quot;CapacityProvider&quot;: <span>{</span>
                            &quot;Ref&quot;: &quot;CapacityProvider2&quot;
                        }
                    }
                ]
            }
        }
    }
}</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider.--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  AutoScalingGroupArn1:  
    Type: String
  AutoScalingGroupArn2:  
    Type: String
Resources:
  CapacityProvider1:
    Type: &quot;AWS::ECS::CapacityProvider&quot;
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !Ref AutoScalingGroupArn1
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  CapacityProvider2:
    Type: &quot;AWS::ECS::CapacityProvider&quot;
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !Ref AutoScalingGroupArn2
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  Cluster:
    Type: &apos;AWS::ECS::Cluster&apos;
  ClusterCPAssociation:
    Type: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;
    Properties:
      Cluster: !Ref Cluster
      CapacityProviders:
        - !Ref CapacityProvider1
        - !Ref CapacityProvider2
      DefaultCapacityProviderStrategy:
        - Base: 2
          Weight: 6
          CapacityProvider: !Ref CapacityProvider1
        - Base: 0
          Weight: 10
          CapacityProvider: !Ref CapacityProvider2</code></pre></div>
                                 <h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an__capacity_provider.">Creating a cluster capacity provider association using an AWS Fargate capacity provider.</h3>
                                 <p>The following example associates the <code class="code">FARGATE</code> and
                                    <code class="code">FARGATE_SPOT</code> capacity providers to an existing cluster. The
                                    cluster name must be specified as a parameter.
                                 </p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an__capacity_provider.--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
    &quot;Parameters&quot;: <span>{</span>
        &quot;ClusterName&quot;: <span>{</span>
            &quot;Type&quot;: &quot;String&quot;
        }
    },
    &quot;Resources&quot;: <span>{</span>
        &quot;ClusterCPAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;Cluster&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;ClusterName&quot;
                },
                &quot;CapacityProviders&quot;: [
                    &quot;FARGATE&quot;,
                    &quot;FARGATE_SPOT&quot;
                ],
                &quot;DefaultCapacityProviderStrategy&quot;: [
                    <span>{</span>
                        &quot;Base&quot;: 2,
                        &quot;Weight&quot;: 1,
                        &quot;CapacityProvider&quot;: &quot;FARGATE&quot;
                    },
                    <span>{</span>
                        &quot;Base&quot;: 0,
                        &quot;Weight&quot;: 1,
                        &quot;CapacityProvider&quot;: &quot;FARGATE_SPOT&quot;
                    }
                ]
            }
        }
    }
}</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an__capacity_provider.--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  ClusterName:  
    Type: String
Resources:
  ClusterCPAssociation:
    Type: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;
    Properties:
      Cluster: !Ref ClusterName
      CapacityProviders:
        - &quot;FARGATE&quot;
        - &quot;FARGATE_SPOT&quot;
      DefaultCapacityProviderStrategy:
        - Base: 2
          Weight: 1
          CapacityProvider: &quot;FARGATE&quot;
        - Base: 0
          Weight: 1
          CapacityProvider: &quot;FARGATE_SPOT&quot;</code></pre></div>
                                 <h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.">Creating a cluster capacity provider association and Auto Scaling group capacity provider.</h3>
                                 <p>The following is an example of how you could use a Lambda function to create
                                    an Auto Scaling group, retrieve the Amazon Resource Name (ARN) of the Auto
                                    Scaling group, and then use the ARN to create an Auto Scaling group capacity
                                    provider, cluster, and the capacity provider association that facilitates the
                                    association between them.
                                 </p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
    &quot;Parameters&quot;: <span>{</span>
        &quot;LatestAmiId&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;&quot;,
            &quot;Default&quot;: &quot;/aws/service/ecs/optimized-ami/amazon-linux-2/recommended/image_id&quot;
        }
    },
    &quot;Resources&quot;: <span>{</span>
        &quot;AutoScalingReadAccessForLambdaRole&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AssumeRolePolicyDocument&quot;: <span>{</span>
                    &quot;Version&quot;: &quot;2012-10-17&quot;,
                    &quot;Statement&quot;: [
                        <span>{</span>
                            &quot;Effect&quot;: &quot;Allow&quot;,
                            &quot;Principal&quot;: <span>{</span>
                                &quot;Service&quot;: [
                                    &quot;lambda.amazonaws.com&quot;
                                ]
                            },
                            &quot;Action&quot;: [
                                &quot;sts:AssumeRole&quot;
                            ]
                        }
                    ]
                },
                &quot;Policies&quot;: [
                    <span>{</span>
                        &quot;PolicyName&quot;: &quot;LambdaReadAsgPolicy&quot;,
                        &quot;PolicyDocument&quot;: <span>{</span>
                            &quot;Version&quot;: &quot;2012-10-17&quot;,
                            &quot;Statement&quot;: [
                                <span>{</span>
                                    &quot;Effect&quot;: &quot;Allow&quot;,
                                    &quot;Action&quot;: &quot;autoscaling:DescribeAutoScalingGroups&quot;,
                                    &quot;Resource&quot;: &quot;*&quot;
                                }
                            ]
                        }
                    }
                ]
            }
        },
        &quot;AsgArnLambda&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::Lambda::Function&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;Runtime&quot;: &quot;python2.7&quot;,
                &quot;Handler&quot;: &quot;index.handler&quot;,
                &quot;Role&quot;: <span>{</span>
                    &quot;Fn::GetAtt&quot;: [
                        &quot;AutoScalingReadAccessForLambdaRole&quot;,
                        &quot;Arn&quot;
                    ]
                },
                &quot;Timeout&quot;: 50,
                &quot;Code&quot;: <span>{</span>
                    &quot;ZipFile&quot;: &quot;import cfnresponse\nimport json\nimport boto3\nclient = boto3.client(&apos;autoscaling&apos;)\ndef handler(event, context):\n  response_data = <span>{</span>}\n  try:\n    autoScalingGroupName = event[&apos;ResourceProperties&apos;][&apos;AsgName&apos;]\n    asg_arn = client.describe_auto_scaling_groups(AutoScalingGroupNames=[autoScalingGroupName])[&apos;AutoScalingGroups&apos;][0][&apos;AutoScalingGroupARN&apos;]\n    response_data[&apos;arn&apos;] = asg_arn\n    cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data, &apos;AsgArnString&apos;)\n  except Exception as e:\n    response_data[&apos;exception&apos;] = e\n    cfnresponse.send(event, context, cfnresponse.FAILED, response_data, &apos;AsgArnString&apos;)\n&quot;
                }
            }
        },
        &quot;LaunchConfig&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::AutoScaling::LaunchConfiguration&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;ImageId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;LatestAmiId&quot;
                },
                &quot;InstanceType&quot;: &quot;t3.micro&quot;,
                &quot;UserData&quot;: <span>{</span>
                    &quot;Fn::Base64&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;#!/bin/bash -xe\necho ECS_CLUSTER=$<span>{</span>Cluster} &gt;&gt; /etc/ecs/ecs.config\n&quot;
                    }
                }
            }
        },
        &quot;AutoScalingGroup&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::AutoScaling::AutoScalingGroup&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZones&quot;: <span>{</span>
                    &quot;Fn::GetAZs&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;AWS::Region&quot;
                    }
                },
                &quot;HealthCheckGracePeriod&quot;: 60,
                &quot;LaunchConfigurationName&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;LaunchConfig&quot;
                },
                &quot;MaxSize&quot;: &quot;0&quot;,
                &quot;MinSize&quot;: &quot;0&quot;
            }
        },
        &quot;AsgArn&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::CloudFormation::CustomResource&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;ServiceToken&quot;: <span>{</span>
                    &quot;Fn::GetAtt&quot;: [
                        &quot;AsgArnLambda&quot;,
                        &quot;Arn&quot;
                    ]
                },
                &quot;AsgName&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;AutoScalingGroup&quot;
                }
            }
        },
        &quot;CapacityProvider&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::CapacityProvider&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AutoScalingGroupProvider&quot;: <span>{</span>
                    &quot;AutoScalingGroupArn&quot;: <span>{</span>
                        &quot;Fn::GetAtt&quot;: [
                            &quot;AsgArn&quot;,
                            &quot;arn&quot;
                        ]
                    },
                    &quot;ManagedScaling&quot;: <span>{</span>
                        &quot;Status&quot;: &quot;ENABLED&quot;
                    },
                    &quot;ManagedTerminationProtection&quot;: &quot;DISABLED&quot;
                }
            }
        },
        &quot;Cluster&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::Cluster&quot;
        },
        &quot;ClusterCPAssoc&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;Cluster&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;Cluster&quot;
                },
                &quot;CapacityProviders&quot;: [
                    <span>{</span>
                        &quot;Ref&quot;: &quot;CapacityProvider&quot;
                    }
                ],
                &quot;DefaultCapacityProviderStrategy&quot;: [
                    <span>{</span>
                        &quot;Base&quot;: 0,
                        &quot;Weight&quot;: 1,
                        &quot;CapacityProvider&quot;: <span>{</span>
                            &quot;Ref&quot;: &quot;CapacityProvider&quot;
                        }
                    }
                ]
            }
        }
    },
    &quot;Outputs&quot;: <span>{</span>
        &quot;ClusterArn&quot;: <span>{</span>
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;Cluster&quot;,
                    &quot;Arn&quot;
                ]
            }
        },
        &quot;ClusterName&quot;: <span>{</span>
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;Cluster&quot;
            }
        },
        &quot;CapacityProviderName&quot;: <span>{</span>
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;CapacityProvider&quot;
            }
        },
        &quot;AsgArn&quot;: <span>{</span>
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;AsgArn&quot;,
                    &quot;arn&quot;
                ]
            }
        }
    }
}</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:  
  LatestAmiId:
    Type: &apos;AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;&apos;
    Default: &apos;/aws/service/ecs/optimized-ami/amazon-linux-2/recommended/image_id&apos;
Resources:
  # Custom resources to retrieve the Auto Scaling group ARN
  AutoScalingReadAccessForLambdaRole:
    Type: &quot;AWS::IAM::Role&quot;
    Properties:
      AssumeRolePolicyDocument:
        Version: &quot;2012-10-17&quot;
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - &quot;lambda.amazonaws.com&quot;
            Action:
              - &quot;sts:AssumeRole&quot;
      Policies:
        - PolicyName: LambdaReadAsgPolicy
          PolicyDocument:
            Version: &quot;2012-10-17&quot;
            Statement:
              - Effect: Allow
                Action: &quot;autoscaling:DescribeAutoScalingGroups&quot;
                Resource: &quot;*&quot;
  AsgArnLambda:
    Type: &quot;AWS::Lambda::Function&quot;
    Properties:
      Runtime: &quot;python2.7&quot;
      Handler: &quot;index.handler&quot;
      Role:
        !GetAtt [ AutoScalingReadAccessForLambdaRole, Arn ]
      Timeout: 50
      Code:
        ZipFile: |
          import cfnresponse
          import json
          import boto3
          client = boto3.client(&apos;autoscaling&apos;)
          def handler(event, context):
            response_data = <span>{</span>}
            try:
              autoScalingGroupName = event[&apos;ResourceProperties&apos;][&apos;AsgName&apos;]
              asg_arn = client.describe_auto_scaling_groups(AutoScalingGroupNames=[autoScalingGroupName])[&apos;AutoScalingGroups&apos;][0][&apos;AutoScalingGroupARN&apos;]
              response_data[&apos;arn&apos;] = asg_arn
              cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data, &apos;AsgArnString&apos;)
            except Exception as e:
              response_data[&apos;exception&apos;] = e
              cfnresponse.send(event, context, cfnresponse.FAILED, response_data, &apos;AsgArnString&apos;)
  # Main resources
  LaunchConfig:
    Type: AWS::AutoScaling::LaunchConfiguration
    Properties:
      ImageId: !Ref LatestAmiId
      InstanceType: &quot;t3.micro&quot;
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash -xe
          echo ECS_CLUSTER=$<span>{</span>Cluster} &gt;&gt; /etc/ecs/ecs.config
  AutoScalingGroup:
    Type: &quot;AWS::AutoScaling::AutoScalingGroup&quot;
    Properties:
      AvailabilityZones:
        Fn::GetAZs: !Ref &quot;AWS::Region&quot;
      HealthCheckGracePeriod: 60
      LaunchConfigurationName: !Ref LaunchConfig
      MaxSize: &quot;0&quot;
      MinSize: &quot;0&quot;
  AsgArn:
    Type: &quot;AWS::CloudFormation::CustomResource&quot;
    Properties:
      ServiceToken: !GetAtt [ AsgArnLambda, Arn ]
      AsgName: !Ref AutoScalingGroup
  CapacityProvider:
    Type: &quot;AWS::ECS::CapacityProvider&quot;
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !GetAtt [ AsgArn, arn ]
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  Cluster:
    Type: &apos;AWS::ECS::Cluster&apos;
  ClusterCPAssoc:
    Type: &quot;AWS::ECS::ClusterCapacityProviderAssociations&quot;
    Properties:
      Cluster: !Ref Cluster
      CapacityProviders:
        - !Ref CapacityProvider
      DefaultCapacityProviderStrategy:
        - Base: 0
          Weight: 1
          CapacityProvider: !Ref CapacityProvider
Outputs:
  ClusterArn:
    Value: !GetAtt
      - Cluster
      - Arn
  ClusterName:
    Value: !Ref Cluster
  CapacityProviderName:
    Value: !Ref CapacityProvider
  AsgArn:
    Value: !GetAtt [ AsgArn, arn ]</code></pre></div>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning"> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the Amazon Web Services Documentation, Javascript must be
                                                enabled. Please refer to your browser&apos;s Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div></div>
</body>
</html>