<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <h1 class="topictitle" id="aws-resource-msk-cluster">AWS::MSK::Cluster</h1><p>The <code class="code">AWS::MSK::Cluster</code> resource creates an Amazon
                        MSK cluster. For more information, see <a href="https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html">What Is Amazon MSK?</a> in the 
                        <em>Amazon MSK Developer Guide</em>.
                     </p><h2 id="aws-resource-msk-cluster-syntax">Syntax</h2><p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p><div id="JSON" name="JSON" class="section langfilter">
                        <h3 id="aws-resource-msk-cluster-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Type&quot; : &quot;AWS::MSK::Cluster&quot;,
  &quot;Properties&quot; : {
      &quot;<a href="#cfn-msk-cluster-brokernodegroupinfo">BrokerNodeGroupInfo</a>&quot; : <em class="replaceable"><code><a href="aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></code></em>,
      &quot;<a href="#cfn-msk-cluster-clientauthentication">ClientAuthentication</a>&quot; : <em class="replaceable"><code><a href="aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></code></em>,
      &quot;<a href="#cfn-msk-cluster-clustername">ClusterName</a>&quot; : <em class="replaceable"><code>String</code></em>,
      &quot;<a href="#cfn-msk-cluster-configurationinfo">ConfigurationInfo</a>&quot; : <em class="replaceable"><code><a href="aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></code></em>,
      &quot;<a href="#cfn-msk-cluster-encryptioninfo">EncryptionInfo</a>&quot; : <em class="replaceable"><code><a href="aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></code></em>,
      &quot;<a href="#cfn-msk-cluster-enhancedmonitoring">EnhancedMonitoring</a>&quot; : <em class="replaceable"><code>String</code></em>,
      &quot;<a href="#cfn-msk-cluster-kafkaversion">KafkaVersion</a>&quot; : <em class="replaceable"><code>String</code></em>,
      &quot;<a href="#cfn-msk-cluster-numberofbrokernodes">NumberOfBrokerNodes</a>&quot; : <em class="replaceable"><code>Integer</code></em>,
      &quot;<a href="#cfn-msk-cluster-tags">Tags</a>&quot; : <em class="replaceable"><code>Json</code></em>
    }
}
</code></pre></div><div id="YAML" name="YAML" class="section langfilter">
                        <h3 id="aws-resource-msk-cluster-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="yaml ">Type: AWS::MSK::Cluster
Properties: 
  <a href="#cfn-msk-cluster-brokernodegroupinfo">BrokerNodeGroupInfo</a>: <em class="replaceable"><code>
    <a href="aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></code></em>
  <a href="#cfn-msk-cluster-clientauthentication">ClientAuthentication</a>: <em class="replaceable"><code>
    <a href="aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></code></em>
  <a href="#cfn-msk-cluster-clustername">ClusterName</a>: <em class="replaceable"><code>String</code></em>
  <a href="#cfn-msk-cluster-configurationinfo">ConfigurationInfo</a>: <em class="replaceable"><code>
    <a href="aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></code></em>
  <a href="#cfn-msk-cluster-encryptioninfo">EncryptionInfo</a>: <em class="replaceable"><code>
    <a href="aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></code></em>
  <a href="#cfn-msk-cluster-enhancedmonitoring">EnhancedMonitoring</a>: <em class="replaceable"><code>String</code></em>
  <a href="#cfn-msk-cluster-kafkaversion">KafkaVersion</a>: <em class="replaceable"><code>String</code></em>
  <a href="#cfn-msk-cluster-numberofbrokernodes">NumberOfBrokerNodes</a>: <em class="replaceable"><code>Integer</code></em>
  <a href="#cfn-msk-cluster-tags">Tags</a>: <em class="replaceable"><code>Json</code></em>
</code></pre></div><h2 id="aws-resource-msk-cluster-properties">Properties</h2><div class="variablelist">
                        <dl>
                           <dt><a id="cfn-msk-cluster-brokernodegroupinfo"></a><span class="term"><code class="code">BrokerNodeGroupInfo</code></span></dt>
                           <dd>
                              
                              <p>The setup to be used for brokers in the cluster.</p>
                              
                              <p><em>Required</em>: Yes
                              </p>
                              <p><em>Type</em>: <a href="aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-clientauthentication"></a><span class="term"><code class="code">ClientAuthentication</code></span></dt>
                           <dd>
                              
                              <p>Includes information related to client authentication.</p>
                              
                              <p><em>Required</em>: No
                              </p>
                              <p><em>Type</em>: <a href="aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-clustername"></a><span class="term"><code class="code">ClusterName</code></span></dt>
                           <dd>
                              
                              
                              <p>The name of the cluster.</p>
                              <p><em>Required</em>: Yes
                              </p>
                              <p><em>Type</em>: String
                              </p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-configurationinfo"></a><span class="term"><code class="code">ConfigurationInfo</code></span></dt>
                           <dd>            
                              
                              <p>The Amazon MSK configuration to use for the cluster.</p>
                              
                              <p><em>Required</em>: No
                              </p>
                              <p><em>Type</em>: <a href="aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-encryptioninfo"></a><span class="term"><code class="code">EncryptionInfo</code></span></dt>
                           <dd>
                              
                              
                              <p>Includes all encryption-related information.</p>
                              <p><em>Required</em>: No
                              </p>
                              <p><em>Type</em>: <a href="aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-enhancedmonitoring"></a><span class="term"><code class="code">EnhancedMonitoring</code></span></dt>
                           <dd>
                              
                              
                              <p>Specifies the level of monitoring for the MSK cluster. The possible values are <code class="code">DEFAULT</code>, <code class="code">PER_BROKER</code>, and <code class="code">PER_TOPIC_PER_BROKER</code>.
                              </p>
                              <p><em>Required</em>: No
                              </p>
                              <p><em>Type</em>: String
                              </p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-kafkaversion"></a><span class="term"><code class="code">KafkaVersion</code></span></dt>
                           <dd>
                              
                              
                              <p>The version of Apache Kafka.</p>
                              <p><em>Required</em>: Yes
                              </p>
                              <p><em>Type</em>: String
                              </p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-numberofbrokernodes"></a><span class="term"><code class="code">NumberOfBrokerNodes</code></span></dt>
                           <dd>            
                              
                              <p>The number of broker nodes you want in the Amazon MSK cluster.</p>
                              
                              <p><em>Required</em>: Yes
                              </p>
                              <p><em>Type</em>: Integer
                              </p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                           <dt><a id="cfn-msk-cluster-tags"></a><span class="term"><code class="code">Tags</code></span></dt>
                           <dd>
                              
                              <p>An array of key-value pairs to apply to this resource. You can specify tags in JSON
                                 or in YAML, depending on which format you use for your template.
                              </p>         
                              
                              <p>For more information, see <a href="aws-properties-resource-tags.html">Tag</a>.
                              </p>
                              
                              <p><em>Required</em>: No
                              </p>
                              <p><em>Type</em>: Json
                              </p>
                              <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                           </dd>
                        </dl>
                     </div><h2 id="aws-resource-msk-cluster-return-values">Return Values</h2><h3 id="aws-resource-msk-cluster-return-values-ref">Ref</h3><p>When you pass the logical ID of this resource to the intrinsic <code class="code">Ref</code> function, <code class="code">Ref</code> returns the Amazon MSK cluster ARN. For example:
                     </p><p>
                        <code class="code">REF MyTestCluster</code>
                        
                     </p><p>For the Amazon MSK cluster <code class="code">MyTestCluster</code>, Ref returns the ARN of the
                        cluster.
                     </p><p>For more information about using the <code class="code">Ref</code> function, see <a href="intrinsic-function-reference-ref.html">Ref</a>.
                     </p><h2 id="aws-resource-msk-cluster--examples">Examples</h2><h3 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Only_Specify_Values_for_the_Required_Properties">Create an MSK Cluster Where You Only Specify Values for the Required Properties</h3><h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Only_Specify_Values_for_the_Required_Properties--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="yaml ">---
Description: &quot;MSK Cluster with required properties.&quot;
Resources:
  TestCluster:
    Type: &quot;AWS::MSK::Cluster&quot;
    Properties:
      ClusterName: &quot;ClusterWithRequiredProperties&quot;
      KafkaVersion: &quot;2.1.0&quot;
      NumberOfBrokerNodes: 3
      BrokerNodeGroupInfo:
        InstanceType: &quot;kafka.m5.large&quot;
        ClientSubnets:
        - &quot;ReplaceWithSubnetId1&quot;
        - &quot;ReplaceWithSubnetId2&quot;
        - &quot;ReplaceWithSubnetId3&quot;</code></pre><h3 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Explicitly_Set_All_Properties">Create an MSK Cluster Where You Explicitly Set All Properties</h3><h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Explicitly_Set_All_Properties--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="yaml ">---
Description: &quot;MSK Cluster with all properties&quot;
Resources:
  TestCluster:
    Type: &quot;AWS::MSK::Cluster&quot;
    Properties:
      ClusterName: &quot;ClusterWithAllProperties&quot;
      KafkaVersion: &quot;2.1.0&quot;
      NumberOfBrokerNodes: 3
      EnhancedMonitoring: &quot;PER_BROKER&quot;
      EncryptionInfo:
        EncryptionAtRest:
          DataVolumeKMSKeyId: &quot;ReplaceWithKmsKeyArn&quot;
        EncryptionInTransit:
          ClientBroker: &quot;TLS&quot;
          InCluster: true
      ConfigurationInfo:
        Arn: &quot;ReplaceWithConfigurationArn&quot;
        Revision: 1
      ClientAuthentication:
        Tls:
          CertificateAuthorityArnList:
          - &quot;ReplaceWithCAArn&quot;
      Tags:
        MyTagName: &quot;MyTagValue&quot;
      BrokerNodeGroupInfo:
        BrokerAZDistribution: &quot;DEFAULT&quot;
        InstanceType: &quot;kafka.m5.large&quot;
        SecurityGroups:
        - &quot;ReplaceWithSecurityGroupId&quot;
        StorageInfo:
          EBSStorageInfo:
            VolumeSize: 100
        ClientSubnets:
        - &quot;ReplaceWithSubnetId1&quot;
        - &quot;ReplaceWithSubnetId2&quot;
        - &quot;ReplaceWithSubnetId3&quot;</code></pre><h3 id="aws-resource-msk-cluster--examples--Create_two_MSK_Clusters_To_Use_With_Apache_MirrorMaker">Create two MSK Clusters To Use With Apache MirrorMaker</h3><p>This YAML shows how to set up two MSK clusters for MirrorMaker. It also sets up the
                        Amazon
                        VPC, subnets, security groups, and IAM roles that are necessary for this example.
                        In
                        addition, it creates an EC2 instance that has Apache Kafka, Java, and the AWS CLI.
                        You can
                        use this EC2 instance to run Apache Kafka tools, including MirrorMaker. You must manually
                        create the MirrorMaker configuration files.
                     </p><h4 id="aws-resource-msk-cluster--examples--Create_two_MSK_Clusters_To_Use_With_Apache_MirrorMaker--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="yaml ">AWSTemplateFormatVersion: &apos;2010-09-09&apos;
Parameters:
  KeyName:
    Description: The name of an existing EC2 KeyPair to enable SSH access to the instance.
    Type: AWS::EC2::KeyPair::KeyName
    ConstraintDescription: Can contain only ASCII characters.
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances.
    Type: String
    MinLength: &apos;9&apos;
    MaxLength: &apos;18&apos;
    Default: 0.0.0.0/0
    AllowedPattern: &quot;(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})&quot;
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x
Mappings:
  SubnetConfig:
      VPC:
        CIDR: &apos;10.0.0.0/16&apos;
      PublicOne:
        CIDR: &apos;10.0.0.0/24&apos;
      PrivateOne:
        CIDR: &apos;10.0.1.0/24&apos;
      PrivateTwo:
        CIDR: &apos;10.0.2.0/24&apos;
      PrivateThree:
        CIDR: &apos;10.0.3.0/24&apos;
  RegionAMI:
      us-east-1:
        HVM64: ami-0c6b1d09930fac512
      us-west-2:
        HVM64: ami-0cb72367e98845d43
Resources:
  # An Amazon VPC to include the MSK clusters and MirrorMaker.
  # The VPC has one public subnet for MirrorMaker and three private subnets for the MSK clusters.
  # To achieve high availability, we distribute the subnets across the first three available AZs in the Region.
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      EnableDnsSupport: true
      EnableDnsHostnames: true
      CidrBlock: !FindInMap [&apos;SubnetConfig&apos;, &apos;VPC&apos;, &apos;CIDR&apos;]
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMVPC&apos;

  PublicSubnetOne:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone:
         Fn::Select:
         - 0
         - Fn::GetAZs: {Ref: &apos;AWS::Region&apos;}
      VpcId: !Ref &apos;VPC&apos;
      CidrBlock: !FindInMap [&apos;SubnetConfig&apos;, &apos;PublicOne&apos;, &apos;CIDR&apos;]
      MapPublicIpOnLaunch: true
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMPublicSubnet&apos;
  PrivateSubnetOne:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone:
         Fn::Select:
         - 0
         - Fn::GetAZs: {Ref: &apos;AWS::Region&apos;}
      VpcId: !Ref &apos;VPC&apos;
      CidrBlock: !FindInMap [&apos;SubnetConfig&apos;, &apos;PrivateOne&apos;, &apos;CIDR&apos;]
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMPrivateSubnetOne&apos;
  PrivateSubnetTwo:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone:
         Fn::Select:
         - 1
         - Fn::GetAZs: {Ref: &apos;AWS::Region&apos;}
      VpcId: !Ref &apos;VPC&apos;
      CidrBlock: !FindInMap [&apos;SubnetConfig&apos;, &apos;PrivateTwo&apos;, &apos;CIDR&apos;]
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMPrivateSubnetTwo&apos;
  PrivateSubnetThree:
    Type: AWS::EC2::Subnet
    Properties:
      AvailabilityZone:
         Fn::Select:
         - 2
         - Fn::GetAZs: {Ref: &apos;AWS::Region&apos;}
      VpcId: !Ref &apos;VPC&apos;
      CidrBlock: !FindInMap [&apos;SubnetConfig&apos;, &apos;PrivateThree&apos;, &apos;CIDR&apos;]
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMPrivateSubnetThree&apos;

  InternetGateway:
    Type: AWS::EC2::InternetGateway
  GatewayAttachement:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref &apos;VPC&apos;
      InternetGatewayId: !Ref &apos;InternetGateway&apos;
  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref &apos;VPC&apos;
  PublicRoute:
    Type: AWS::EC2::Route
    DependsOn: GatewayAttachement
    Properties:
      RouteTableId: !Ref &apos;PublicRouteTable&apos;
      DestinationCidrBlock: &apos;0.0.0.0/0&apos;
      GatewayId: !Ref &apos;InternetGateway&apos;
  PublicSubnetOneRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnetOne
      RouteTableId: !Ref PublicRouteTable
  PrivateRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref &apos;VPC&apos;
  PrivateSubnetOneRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetOne
  PrivateSubnetTwoRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetTwo
  PrivateSubnetThreeRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetThree
  MMInstanceSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
     GroupDescription: Enable SSH access via port 22
      VpcId: !Ref &apos;VPC&apos;
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 22
        ToPort: 22
        CidrIp: !Ref &apos;SSHLocation&apos;
  MSKSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Enable SSH access via port 22
      VpcId: !Ref &apos;VPC&apos;
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 2181
        ToPort: 2181
        SourceSecurityGroupId: !GetAtt MMInstanceSecurityGroup.GroupId
      - IpProtocol: tcp
        FromPort: 9094
        ToPort: 9094
        SourceSecurityGroupId: !GetAtt MMInstanceSecurityGroup.GroupId
      - IpProtocol: tcp
        FromPort: 9092
        ToPort: 9092
        SourceSecurityGroupId: !GetAtt MMInstanceSecurityGroup.GroupId
  MMEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: m5.large
      KeyName: !Ref &apos;KeyName&apos;
      IamInstanceProfile: !Ref EC2InstanceProfile
      AvailabilityZone: 
        Fn::Select:
         - 0
         - Fn::GetAZs: {Ref: &apos;AWS::Region&apos;}
      SubnetId: !Ref &apos;PublicSubnetOne&apos;
      SecurityGroupIds: [!GetAtt MMInstanceSecurityGroup.GroupId]
      ImageId: !FindInMap [&apos;RegionAMI&apos;, !Ref &apos;AWS::Region&apos;, &apos;HVM64&apos;]
      Tags:
        - Key: &apos;Name&apos;
          Value: &apos;MMInstance&apos;
      UserData: 
        Fn::Base64: |
          #!/bin/bash
          yum update -y 
          yum install python3.7 -y
          yum install java-1.8.0-openjdk-devel -y
          yum erase awscli -y
          cd /home/ec2-user
          echo &quot;export PATH=.local/bin:$PATH&quot; &gt;&gt; .bash_profile
          mkdir kafka
          mkdir mm
          cd kafka
          wget https://archive.apache.org/dist/kafka/2.1.0/kafka_2.12-2.1.0.tgz
          tar -xzf kafka_2.12-2.1.0.tgz
          cd /home/ec2-user
          wget https://bootstrap.pypa.io/get-pip.py
          su -c &quot;python3.7 get-pip.py --user&quot; -s /bin/sh ec2-user
          su -c &quot;/home/ec2-user/.local/bin/pip3 install boto3 --user&quot; -s /bin/sh ec2-user
          su -c &quot;/home/ec2-user/.local/bin/pip3 install awscli --user&quot; -s /bin/sh ec2-user
          chown -R ec2-user ./kafka
          chgrp -R ec2-user ./kafka
          chown -R ec2-user ./mm
          chgrp -R ec2-user ./mm

  EC2Role: 
    Type: AWS::IAM::Role
    Properties:
     AssumeRolePolicyDocument: 
        Version: 2012-10-17
        Statement:
          - Sid: &apos;&apos;
            Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
            Action: &apos;sts:AssumeRole&apos;
      Path: &quot;/&quot;
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonMSKFullAccess
        - arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess
  EC2InstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties: 
      InstanceProfileName: EC2MSKCFProfile
      Roles:
        - !Ref EC2Role
  MSKMMCluster1:
    Type: AWS::MSK::Cluster
    Properties: 
      BrokerNodeGroupInfo: 
        ClientSubnets: [!Ref &apos;PrivateSubnetOne&apos;, !Ref &apos;PrivateSubnetTwo&apos;, !Ref &apos;PrivateSubnetThree&apos;]
        InstanceType: kafka.m5.large
        SecurityGroups: [!GetAtt MSKSecurityGroup.GroupId]
        StorageInfo: 
          EBSStorageInfo:
            VolumeSize: 2000
      ClusterName: MSKMMCluster1
      EncryptionInfo: 
        EncryptionInTransit: 
          ClientBroker: TLS
          InCluster: true
      EnhancedMonitoring: PER_TOPIC_PER_BROKER
      KafkaVersion: 2.1.0
      NumberOfBrokerNodes: 3
  MSKMMCluster2:
    Type: AWS::MSK::Cluster
    Properties: 
      BrokerNodeGroupInfo: 
        ClientSubnets: [!Ref &apos;PrivateSubnetOne&apos;, !Ref &apos;PrivateSubnetTwo&apos;, !Ref &apos;PrivateSubnetThree&apos;]
        InstanceType: kafka.m5.large
        SecurityGroups: [!GetAtt MSKSecurityGroup.GroupId]
        StorageInfo: 
          EBSStorageInfo:
            VolumeSize: 2000
      ClusterName: MSKMMCluster2
      EncryptionInfo: 
        EncryptionInTransit: 
          ClientBroker: TLS
          InCluster: true
      EnhancedMonitoring: PER_TOPIC_PER_BROKER
      KafkaVersion: 2.1.0
      NumberOfBrokerNodes: 3

Outputs:
  VPCId: 
    Description: The ID of the VPC created
    Value: !Ref &apos;VPC&apos;
  PublicSubnetOne: 
    Description: The name of the public subnet created
    Value: !Ref &apos;PublicSubnetOne&apos;
  PrivateSubnetOne: 
    Description: The ID of private subnet one created
    Value: !Ref &apos;PrivateSubnetOne&apos;
  PrivateSubnetTwo: 
    Description: The ID of private subnet two created
    Value: !Ref &apos;PrivateSubnetTwo&apos;
  PrivateSubnetThree: 
    Description: The ID of private subnet three created
    Value: !Ref &apos;PrivateSubnetThree&apos;
  MSKSecurityGroupID: 
    Description: The ID of the security group created for the MSK clusters
    Value: !GetAtt MSKSecurityGroup.GroupId
  MMEC2InstancePublicDNS:
    Description: The Public DNS for the MirrorMaker EC2 instance
    Value: !GetAtt MMEC2Instance.PublicDnsName
  MSKMMCluster1Arn:
    Description: The Arn for the MSKMMCluster1 MSK cluster
    Value: !Ref &apos;MSKMMCluster1&apos;
  MSKMMCluster2Arn:
    Description: The Arn for the MSKMMCluster2 MSK cluster
    Value: !Ref &apos;MSKMMCluster2&apos;</code></pre><div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div></div>
</body>
</html>