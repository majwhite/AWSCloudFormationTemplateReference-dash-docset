<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="aws-resource-msk-cluster">AWS::MSK::Cluster</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The <code class="code">AWS::MSK::Cluster</code> resource creates an Amazon
                                    MSK cluster. For more information, see <a href="https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html">What Is Amazon MSK?</a> in the 
                                    <em>Amazon MSK Developer Guide</em>.
                                 </p>
                                 <h2 id="aws-resource-msk-cluster-syntax">Syntax</h2>
                                 <p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h3 id="aws-resource-msk-cluster-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  &quot;Type&quot; : &quot;AWS::MSK::Cluster&quot;,
  &quot;Properties&quot; : <span>{</span>
      &quot;<a href="#cfn-msk-cluster-brokernodegroupinfo">BrokerNodeGroupInfo</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></code>,
      &quot;<a href="#cfn-msk-cluster-clientauthentication">ClientAuthentication</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></code>,
      &quot;<a href="#cfn-msk-cluster-clustername">ClusterName</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-msk-cluster-configurationinfo">ConfigurationInfo</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></code>,
      &quot;<a href="#cfn-msk-cluster-encryptioninfo">EncryptionInfo</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></code>,
      &quot;<a href="#cfn-msk-cluster-enhancedmonitoring">EnhancedMonitoring</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-msk-cluster-kafkaversion">KafkaVersion</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-msk-cluster-logginginfo">LoggingInfo</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-logginginfo.html">LoggingInfo</a></code>,
      &quot;<a href="#cfn-msk-cluster-numberofbrokernodes">NumberOfBrokerNodes</a>&quot; : <code class="replaceable">Integer</code>,
      &quot;<a href="#cfn-msk-cluster-openmonitoring">OpenMonitoring</a>&quot; : <code class="replaceable"><a href="./aws-properties-msk-cluster-openmonitoring.html">OpenMonitoring</a></code>,
      &quot;<a href="#cfn-msk-cluster-tags">Tags</a>&quot; : <code class="replaceable">Json</code>
    }
}
</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h3 id="aws-resource-msk-cluster-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::MSK::Cluster
Properties: 
  <a href="#cfn-msk-cluster-brokernodegroupinfo">BrokerNodeGroupInfo</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></code>
  <a href="#cfn-msk-cluster-clientauthentication">ClientAuthentication</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></code>
  <a href="#cfn-msk-cluster-clustername">ClusterName</a>: <code class="replaceable">String</code>
  <a href="#cfn-msk-cluster-configurationinfo">ConfigurationInfo</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></code>
  <a href="#cfn-msk-cluster-encryptioninfo">EncryptionInfo</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></code>
  <a href="#cfn-msk-cluster-enhancedmonitoring">EnhancedMonitoring</a>: <code class="replaceable">String</code>
  <a href="#cfn-msk-cluster-kafkaversion">KafkaVersion</a>: <code class="replaceable">String</code>
  <a href="#cfn-msk-cluster-logginginfo">LoggingInfo</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-logginginfo.html">LoggingInfo</a></code>
  <a href="#cfn-msk-cluster-numberofbrokernodes">NumberOfBrokerNodes</a>: <code class="replaceable">Integer</code>
  <a href="#cfn-msk-cluster-openmonitoring">OpenMonitoring</a>: <code class="replaceable">
    <a href="./aws-properties-msk-cluster-openmonitoring.html">OpenMonitoring</a></code>
  <a href="#cfn-msk-cluster-tags">Tags</a>: <code class="replaceable">Json</code>
</code></pre></div>
                                 <h2 id="aws-resource-msk-cluster-properties">Properties</h2>
                                 <div class="variablelist">
                                    <dl>
                                       <dt><a id="cfn-msk-cluster-brokernodegroupinfo"></a><span class="term"><code class="code">BrokerNodeGroupInfo</code></span></dt>
                                       <dd>
                                          
                                          <p>The setup to be used for brokers in the cluster.</p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-brokernodegroupinfo.html">BrokerNodeGroupInfo</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-clientauthentication"></a><span class="term"><code class="code">ClientAuthentication</code></span></dt>
                                       <dd>
                                          
                                          <p>Includes information related to client authentication.</p>
                                          
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-clientauthentication.html">ClientAuthentication</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-clustername"></a><span class="term"><code class="code">ClusterName</code></span></dt>
                                       <dd>
                                          
                                          
                                          <p>The name of the cluster.</p>
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-configurationinfo"></a><span class="term"><code class="code">ConfigurationInfo</code></span></dt>
                                       <dd>            
                                          
                                          <p>The Amazon MSK configuration to use for the cluster.</p>
                                          
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-configurationinfo.html">ConfigurationInfo</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-encryptioninfo"></a><span class="term"><code class="code">EncryptionInfo</code></span></dt>
                                       <dd>
                                          
                                          
                                          <p>Includes all encryption-related information.</p>
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-encryptioninfo.html">EncryptionInfo</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-enhancedmonitoring"></a><span class="term"><code class="code">EnhancedMonitoring</code></span></dt>
                                       <dd>
                                          
                                          
                                          <p>Specifies the level of monitoring for the MSK cluster. The possible values are <code class="code">DEFAULT</code>, <code class="code">PER_BROKER</code>, and <code class="code">PER_TOPIC_PER_BROKER</code>.
                                          </p>
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-kafkaversion"></a><span class="term"><code class="code">KafkaVersion</code></span></dt>
                                       <dd>
                                          
                                          
                                          <p>The version of Apache Kafka. You can use Amazon MSK to create clusters that use Apache
                                             Kafka versions 1.1.1 and 2.2.1.
                                          </p>
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-logginginfo"></a><span class="term"><code class="code">LoggingInfo</code></span></dt>
                                       <dd>
                                          <p>You can configure your MSK cluster to send broker logs to different destination types.
                                             This is a container for the configuration details related to broker logs.
                                          </p>
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-logginginfo.html">LoggingInfo</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-numberofbrokernodes"></a><span class="term"><code class="code">NumberOfBrokerNodes</code></span></dt>
                                       <dd>            
                                          
                                          <p>The number of broker nodes you want in the Amazon MSK cluster. You can
                                             submit an update to increase the number of broker nodes in a cluster.
                                          </p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: Integer
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-openmonitoring"></a><span class="term"><code class="code">OpenMonitoring</code></span></dt>
                                       <dd>
                                          
                                          
                                          <p>The settings for open monitoring.</p>
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-msk-cluster-openmonitoring.html">OpenMonitoring</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-msk-cluster-tags"></a><span class="term"><code class="code">Tags</code></span></dt>
                                       <dd>
                                          
                                          <p>A map of key:value pairs to apply to this resource. Both key and value are of
                                             type String.
                                          </p>
                                          
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: Json
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                    </dl>
                                 </div>
                                 <h2 id="aws-resource-msk-cluster-return-values">Return values</h2>
                                 <h3 id="aws-resource-msk-cluster-return-values-ref">Ref</h3>
                                 <p>When you pass the logical ID of this resource to the intrinsic <code class="code">Ref</code> function, <code class="code">Ref</code> returns the Amazon MSK cluster ARN. For example:
                                 </p>
                                 <p>
                                    <code class="code">REF MyTestCluster</code>
                                    
                                 </p>
                                 <p>For the Amazon MSK cluster <code class="code">MyTestCluster</code>, Ref returns the ARN of the
                                    cluster.
                                 </p>
                                 <p>For more information about using the <code class="code">Ref</code> function, see <a href="intrinsic-function-reference-ref.html">Ref</a>.
                                 </p>
                                 <h2 id="aws-resource-msk-cluster--examples">Examples</h2>
                                 <p>In the following examples you can find the YAML for each template, followed by the
                                    equivalent JSON. You can use either language.
                                 </p>
                                 <h3 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Only_Specify_Values_for_the_Required_Properties">Create an MSK Cluster Where You Only Specify Values for the Required Properties</h3>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Only_Specify_Values_for_the_Required_Properties--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Description: MSK Cluster with required properties.
Resources:
  TestCluster:
    Type: &apos;AWS::MSK::Cluster&apos;
    Properties:
      ClusterName: ClusterWithRequiredProperties
      KafkaVersion: 2.2.1
      NumberOfBrokerNodes: 3
      BrokerNodeGroupInfo:
        InstanceType: kafka.m5.large
        ClientSubnets:
          - ReplaceWithSubnetId1
          - ReplaceWithSubnetId2
          - ReplaceWithSubnetId3
</code></pre></div>
                                 <div id="" name="" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Only_Specify_Values_for_the_Required_Properties--JSON"></h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    &quot;Description&quot;: &quot;MSK Cluster with required properties.&quot;,
    &quot;Resources&quot;: <span>{</span>
        &quot;TestCluster&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::MSK::Cluster&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;ClusterName&quot;: &quot;ClusterWithRequiredProperties&quot;,
                &quot;KafkaVersion&quot;: &quot;2.2.1&quot;,
                &quot;NumberOfBrokerNodes&quot;: 3,
                &quot;BrokerNodeGroupInfo&quot;: <span>{</span>
                    &quot;InstanceType&quot;: &quot;kafka.m5.large&quot;,
                    &quot;ClientSubnets&quot;: [
                        &quot;ReplaceWithSubnetId1&quot;,
                        &quot;ReplaceWithSubnetId2&quot;,
                        &quot;ReplaceWithSubnetId3&quot;
                    ]
                }
            }
        }
    }
}</code></pre></div>
                                 <h3 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Explicitly_Set_All_Properties">Create an MSK Cluster Where You Explicitly Set All Properties</h3>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Explicitly_Set_All_Properties--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Description: MSK Cluster with all properties
Resources:
  TestCluster:
    Type: &apos;AWS::MSK::Cluster&apos;
    Properties:
      ClusterName: ClusterWithAllProperties
      KafkaVersion: 2.2.1
      NumberOfBrokerNodes: 3
      EnhancedMonitoring: PER_BROKER
      EncryptionInfo:
        EncryptionAtRest:
          DataVolumeKMSKeyId: ReplaceWithKmsKeyArn
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
      OpenMonitoring:
        Prometheus:
          JmxExporter:
            EnabledInBroker: &quot;true&quot;
          NodeExporter:
            EnabledInBroker: &quot;true&quot;
      ConfigurationInfo:
        Arn: ReplaceWithConfigurationArn
        Revision: 1
      ClientAuthentication:
        Tls:
          CertificateAuthorityArnList:
            - ReplaceWithCAArn
      Tags:
        Environment: Test
        Owner: QATeam
      BrokerNodeGroupInfo:
        BrokerAZDistribution: DEFAULT
        InstanceType: kafka.m5.large
        SecurityGroups:
          - ReplaceWithSecurityGroupId
        StorageInfo:
          EBSStorageInfo:
            VolumeSize: 100
        ClientSubnets:
          - ReplaceWithSubnetId1
          - ReplaceWithSubnetId2
          - ReplaceWithSubnetId3</code></pre></div>
                                 <div id="" name="" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_an_MSK_Cluster_Where_You_Explicitly_Set_All_Properties--JSON"></h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    &quot;Description&quot;: &quot;MSK Cluster with all properties&quot;,
    &quot;Resources&quot;: <span>{</span>
        &quot;TestCluster&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::MSK::Cluster&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;ClusterName&quot;: &quot;ClusterWithAllProperties&quot;,
                &quot;KafkaVersion&quot;: &quot;2.2.1&quot;,
                &quot;NumberOfBrokerNodes&quot;: 3,
                &quot;EnhancedMonitoring&quot;: &quot;PER_BROKER&quot;,
                &quot;EncryptionInfo&quot;: <span>{</span>
                    &quot;EncryptionAtRest&quot;: <span>{</span>
                        &quot;DataVolumeKMSKeyId&quot;: &quot;ReplaceWithKmsKeyArn&quot;
                    },
                    &quot;EncryptionInTransit&quot;: <span>{</span>
                        &quot;ClientBroker&quot;: &quot;TLS&quot;,
                        &quot;InCluster&quot;: true
                    }
                },
                &quot;OpenMonitoring&quot;: <span>{</span>
                    &quot;Prometheus&quot;: <span>{</span>
                        &quot;JmxExporter&quot;: <span>{</span>
                            &quot;EnabledInBroker&quot;: &quot;true&quot;
                        }
                        &quot;NodeExporter&quot;: <span>{</span>
                            &quot;EnabledInBroker&quot;: &quot;true&quot;
                        }
                    }
                },
                &quot;ConfigurationInfo&quot;: <span>{</span>
                    &quot;Arn&quot;: &quot;ReplaceWithConfigurationArn&quot;,
                    &quot;Revision&quot;: 1
                },
                &quot;ClientAuthentication&quot;: <span>{</span>
                    &quot;Tls&quot;: <span>{</span>
                        &quot;CertificateAuthorityArnList&quot;: [
                            &quot;ReplaceWithCAArn&quot;
                        ]
                    }
                },
                &quot;Tags&quot;: <span>{</span>
                    &quot;Environment&quot;: &quot;Test&quot;,
                    &quot;Owner&quot; : &quot;QATeam&quot;
                },
                &quot;BrokerNodeGroupInfo&quot;: <span>{</span>
                    &quot;BrokerAZDistribution&quot;: &quot;DEFAULT&quot;,
                    &quot;InstanceType&quot;: &quot;kafka.m5.large&quot;,
                    &quot;SecurityGroups&quot;: [
                        &quot;ReplaceWithSecurityGroupId&quot;
                    ],
                    &quot;StorageInfo&quot;: <span>{</span>
                        &quot;EBSStorageInfo&quot;: <span>{</span>
                            &quot;VolumeSize&quot;: 100
                        }
                    },
                    &quot;ClientSubnets&quot;: [
                        &quot;ReplaceWithSubnetId1&quot;,
                        &quot;ReplaceWithSubnetId2&quot;,
                        &quot;ReplaceWithSubnetId3&quot;
                    ]
                }
            }
        }
    }
}</code></pre></div>
                                 <h3 id="aws-resource-msk-cluster--examples--Get_Started_With_Amazon_MSK">Get Started With Amazon MSK</h3>
                                 <p>This example template creates an MSK cluster in a simple architecture to help you
                                    get started.
                                 </p>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Get_Started_With_Amazon_MSK--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instance
    Type: &apos;AWS::EC2::KeyPair::KeyName&apos;
    ConstraintDescription: Can contain only ASCII characters.
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances
    Type: String
    MinLength: &apos;9&apos;
    MaxLength: &apos;18&apos;
    Default: 0.0.0.0/0
    AllowedPattern: &apos;(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})&apos;
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x
Mappings:
  SubnetConfig:
    VPC:
      CIDR: 10.0.0.0/16
    PublicOne:
      CIDR: 10.0.0.0/24
    PrivateOne:
      CIDR: 10.0.1.0/24
    PrivateTwo:
      CIDR: 10.0.2.0/24
    PrivateThree:
      CIDR: 10.0.3.0/24
  RegionAMI:
    us-east-1:
      HVM64: ami-0c6b1d09930fac512
    us-west-2:
      HVM64: ami-0cb72367e98845d43
Resources:
  VPC:
    Type: &apos;AWS::EC2::VPC&apos;
    Properties:
      EnableDnsSupport: true
      EnableDnsHostnames: true
      CidrBlock: !FindInMap 
        - SubnetConfig
        - VPC
        - CIDR
      Tags:
        - Key: Name
          Value: MMVPC
  PublicSubnetOne:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PublicOne
        - CIDR
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: MMPublicSubnet
  PrivateSubnetOne:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateOne
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetOne
  PrivateSubnetTwo:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 1
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateTwo
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetTwo
  PrivateSubnetThree:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 2
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateThree
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetThree
  InternetGateway:
    Type: &apos;AWS::EC2::InternetGateway&apos;
  GatewayAttachement:
    Type: &apos;AWS::EC2::VPCGatewayAttachment&apos;
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
  PublicRouteTable:
    Type: &apos;AWS::EC2::RouteTable&apos;
    Properties:
      VpcId: !Ref VPC
  PublicRoute:
    Type: &apos;AWS::EC2::Route&apos;
    DependsOn: GatewayAttachement
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  PublicSubnetOneRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      SubnetId: !Ref PublicSubnetOne
      RouteTableId: !Ref PublicRouteTable
  PrivateRouteTable:
    Type: &apos;AWS::EC2::RouteTable&apos;
    Properties:
      VpcId: !Ref VPC
  PrivateSubnetOneRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetOne
  PrivateSubnetTwoRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetTwo
  PrivateSubnetThreeRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetThree
  KafkaClientInstanceSecurityGroup:
    Type: &apos;AWS::EC2::SecurityGroup&apos;
    Properties:
      GroupDescription: Enable SSH access via port 22
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation
  MSKSecurityGroup:
    Type: &apos;AWS::EC2::SecurityGroup&apos;
    Properties:
      GroupDescription: Enable SSH access via port 22
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 2181
          ToPort: 2181
          SourceSecurityGroupId: !GetAtt 
            - KafkaClientInstanceSecurityGroup
            - GroupId
        - IpProtocol: tcp
          FromPort: 9094
          ToPort: 9094
          SourceSecurityGroupId: !GetAtt 
            - KafkaClientInstanceSecurityGroup
            - GroupId
        - IpProtocol: tcp
          FromPort: 9092
          ToPort: 9092
          SourceSecurityGroupId: !GetAtt 
            - KafkaClientInstanceSecurityGroup
            - GroupId
  KafkaClientEC2Instance:
    Type: &apos;AWS::EC2::Instance&apos;
    Properties:
      InstanceType: m5.large
      KeyName: !Ref KeyName
      IamInstanceProfile: !Ref EC2InstanceProfile
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      SubnetId: !Ref PublicSubnetOne
      SecurityGroupIds:
        - !GetAtt 
          - KafkaClientInstanceSecurityGroup
          - GroupId
      ImageId: !FindInMap 
        - RegionAMI
        - !Ref &apos;AWS::Region&apos;
        - HVM64
      Tags:
        - Key: Name
          Value: KafkaClientInstance
      UserData: !Base64 &gt;
        #!/bin/bash

        yum update -y 

        yum install python3.7 -y

        yum install java-1.8.0-openjdk-devel -y

        yum erase awscli -y

        cd /home/ec2-user

        echo &quot;export PATH=.local/bin:$PATH&quot; &gt;&gt; .bash_profile

        mkdir kafka

        mkdir mm

        cd kafka

        wget https://archive.apache.org/dist/kafka/2.2.1/kafka_2.12-2.2.1.tgz

        tar -xzf kafka_2.12-2.2.1.tgz

        cd /home/ec2-user

        wget https://bootstrap.pypa.io/get-pip.py

        su -c &quot;python3.7 get-pip.py --user&quot; -s /bin/sh ec2-user

        su -c &quot;/home/ec2-user/.local/bin/pip3 install boto3 --user&quot; -s /bin/sh
        ec2-user

        su -c &quot;/home/ec2-user/.local/bin/pip3 install awscli --user&quot; -s /bin/sh
        ec2-user

        chown -R ec2-user ./kafka

        chgrp -R ec2-user ./kafka

        chown -R ec2-user ./mm

        chgrp -R ec2-user ./mm
  EC2Role:
    Type: &apos;AWS::IAM::Role&apos;
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Sid: &apos;&apos;
            Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
            Action: &apos;sts:AssumeRole&apos;
      Path: /
      ManagedPolicyArns:
        - &apos;arn:aws:iam::aws:policy/AmazonMSKFullAccess&apos;
        - &apos;arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess&apos;
  EC2InstanceProfile:
    Type: &apos;AWS::IAM::InstanceProfile&apos;
    Properties:
      InstanceProfileName: EC2MSKCFProfile
      Roles:
        - !Ref EC2Role
  MSKCluster:
    Type: &apos;AWS::MSK::Cluster&apos;
    Properties:
      BrokerNodeGroupInfo:
        ClientSubnets:
          - !Ref PrivateSubnetOne
          - !Ref PrivateSubnetTwo
          - !Ref PrivateSubnetThree
        InstanceType: kafka.m5.large
        SecurityGroups:
          - !GetAtt 
            - MSKSecurityGroup
            - GroupId
        StorageInfo:
          EBSStorageInfo:
            VolumeSize: 2000
      ClusterName: MSKCluster
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
      EnhancedMonitoring: PER_TOPIC_PER_BROKER
      KafkaVersion: 2.2.1
      NumberOfBrokerNodes: 3
Outputs:
  VPCId:
    Description: The ID of the VPC created
    Value: !Ref VPC
  PublicSubnetOne:
    Description: The name of the public subnet created
    Value: !Ref PublicSubnetOne
  PrivateSubnetOne:
    Description: The ID of private subnet one created
    Value: !Ref PrivateSubnetOne
  PrivateSubnetTwo:
    Description: The ID of private subnet two created
    Value: !Ref PrivateSubnetTwo
  PrivateSubnetThree:
    Description: The ID of private subnet three created
    Value: !Ref PrivateSubnetThree
  MSKSecurityGroupID:
    Description: The ID of the security group created for the MSK clusters
    Value: !GetAtt 
      - MSKSecurityGroup
      - GroupId
  KafkaClientEC2InstancePublicDNS:
    Description: The Public DNS for the MirrorMaker EC2 instance
    Value: !GetAtt 
      - KafkaClientEC2Instance
      - PublicDnsName
  MSKClusterArn:
    Description: The Arn for the MSKMMCluster1 MSK cluster
    Value: !Ref MSKCluster
</code></pre></div>
                                 <div id="" name="" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Get_Started_With_Amazon_MSK--JSON"></h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
    &quot;Parameters&quot;: <span>{</span>
        &quot;KeyName&quot;: <span>{</span>
            &quot;Description&quot;: &quot;Name of an existing EC2 KeyPair to enable SSH access to the instance&quot;,
            &quot;Type&quot;: &quot;AWS::EC2::KeyPair::KeyName&quot;,
            &quot;ConstraintDescription&quot;: &quot;Can contain only ASCII characters.&quot;
        },
        &quot;SSHLocation&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The IP address range that can be used to SSH to the EC2 instances&quot;,
            &quot;Type&quot;: &quot;String&quot;,
            &quot;MinLength&quot;: &quot;9&quot;,
            &quot;MaxLength&quot;: &quot;18&quot;,
            &quot;Default&quot;: &quot;0.0.0.0/0&quot;,
            &quot;AllowedPattern&quot;: &quot;(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})&quot;,
            &quot;ConstraintDescription&quot;: &quot;Must be a valid IP CIDR range of the form x.x.x.x/x&quot;
        }
    },
    &quot;Mappings&quot;: <span>{</span>
        &quot;SubnetConfig&quot;: <span>{</span>
            &quot;VPC&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.0.0/16&quot;
            },
            &quot;PublicOne&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.0.0/24&quot;
            },
            &quot;PrivateOne&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.1.0/24&quot;
            },
            &quot;PrivateTwo&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.2.0/24&quot;
            },
            &quot;PrivateThree&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.3.0/24&quot;
            }
        },
        &quot;RegionAMI&quot;: <span>{</span>
            &quot;us-east-1&quot;: <span>{</span>
                &quot;HVM64&quot;: &quot;ami-0c6b1d09930fac512&quot;
            },
            &quot;us-west-2&quot;: <span>{</span>
                &quot;HVM64&quot;: &quot;ami-0cb72367e98845d43&quot;
            }
        }
    },
    &quot;Resources&quot;: <span>{</span>
        &quot;VPC&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::VPC&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;EnableDnsSupport&quot;: true,
                &quot;EnableDnsHostnames&quot;: true,
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;VPC&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMVPC&quot;
                    }
                ]
            }
        },
        &quot;PublicSubnetOne&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PublicOne&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;MapPublicIpOnLaunch&quot;: true,
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPublicSubnet&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetOne&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateOne&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetOne&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetTwo&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        1,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateTwo&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetTwo&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetThree&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        2,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateThree&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetThree&quot;
                    }
                ]
            }
        },
        &quot;InternetGateway&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::InternetGateway&quot;
        },
        &quot;GatewayAttachement&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::VPCGatewayAttachment&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;InternetGatewayId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;InternetGateway&quot;
                }
            }
        },
        &quot;PublicRouteTable&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::RouteTable&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                }
            }
        },
        &quot;PublicRoute&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Route&quot;,
            &quot;DependsOn&quot;: &quot;GatewayAttachement&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicRouteTable&quot;
                },
                &quot;DestinationCidrBlock&quot;: &quot;0.0.0.0/0&quot;,
                &quot;GatewayId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;InternetGateway&quot;
                }
            }
        },
        &quot;PublicSubnetOneRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
                },
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicRouteTable&quot;
                }
            }
        },
        &quot;PrivateRouteTable&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::RouteTable&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                }
            }
        },
        &quot;PrivateSubnetOneRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
                }
            }
        },
        &quot;PrivateSubnetTwoRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
                }
            }
        },
        &quot;PrivateSubnetThreeRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
                }
            }
        },
        &quot;KafkaClientInstanceSecurityGroup&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SecurityGroup&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;GroupDescription&quot;: &quot;Enable SSH access via port 22&quot;,
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;SecurityGroupIngress&quot;: [
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 22,
                        &quot;ToPort&quot;: 22,
                        &quot;CidrIp&quot;: <span>{</span>
                            &quot;Ref&quot;: &quot;SSHLocation&quot;
                        }
                    }
                ]
            }
        },
        &quot;MSKSecurityGroup&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SecurityGroup&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;GroupDescription&quot;: &quot;Enable SSH access via port 22&quot;,
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;SecurityGroupIngress&quot;: [
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 2181,
                        &quot;ToPort&quot;: 2181,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;KafkaClientInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    },
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 9094,
                        &quot;ToPort&quot;: 9094,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;KafkaClientInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    },
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 9092,
                        &quot;ToPort&quot;: 9092,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;KafkaClientInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    }
                ]
            }
        },
        &quot;KafkaClientEC2Instance&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Instance&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;InstanceType&quot;: &quot;m5.large&quot;,
                &quot;KeyName&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;KeyName&quot;
                },
                &quot;IamInstanceProfile&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;EC2InstanceProfile&quot;
                },
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
                },
                &quot;SecurityGroupIds&quot;: [
                    <span>{</span>
                        &quot;Fn::GetAtt&quot;: [
                            &quot;KafkaClientInstanceSecurityGroup&quot;,
                            &quot;GroupId&quot;
                        ]
                    }
                ],
                &quot;ImageId&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;RegionAMI&quot;,
                        <span>{</span>
                            &quot;Ref&quot;: &quot;AWS::Region&quot;
                        },
                        &quot;HVM64&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;KafkaClientInstance&quot;
                    }
                ],
                &quot;UserData&quot;: <span>{</span>
                    &quot;Fn::Base64&quot;: &quot;#!/bin/bash\nyum update -y \nyum install python3.7 -y\nyum install java-1.8.0-openjdk-devel -y\nyum erase awscli -y\ncd /home/ec2-user\necho \&quot;export PATH=.local/bin:$PATH\&quot; &gt;&gt; .bash_profile\nmkdir kafka\nmkdir mm\ncd kafka\nwget https://archive.apache.org/dist/kafka/2.2.1/kafka_2.12-2.2.1.tgz\ntar -xzf kafka_2.12-2.2.1.tgz\ncd /home/ec2-user\nwget https://bootstrap.pypa.io/get-pip.py\nsu -c \&quot;python3.7 get-pip.py --user\&quot; -s /bin/sh ec2-user\nsu -c \&quot;/home/ec2-user/.local/bin/pip3 install boto3 --user\&quot; -s /bin/sh ec2-user\nsu -c \&quot;/home/ec2-user/.local/bin/pip3 install awscli --user\&quot; -s /bin/sh ec2-user\nchown -R ec2-user ./kafka\nchgrp -R ec2-user ./kafka\nchown -R ec2-user ./mm\nchgrp -R ec2-user ./mm\n&quot;
                }
            }
        },
        &quot;EC2Role&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AssumeRolePolicyDocument&quot;: <span>{</span>
                    &quot;Version&quot;: &quot;2012-10-17&quot;,
                    &quot;Statement&quot;: [
                        <span>{</span>
                            &quot;Sid&quot;: &quot;&quot;,
                            &quot;Effect&quot;: &quot;Allow&quot;,
                            &quot;Principal&quot;: <span>{</span>
                                &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;
                            },
                            &quot;Action&quot;: &quot;sts:AssumeRole&quot;
                        }
                    ]
                },
                &quot;Path&quot;: &quot;/&quot;,
                &quot;ManagedPolicyArns&quot;: [
                    &quot;arn:aws:iam::aws:policy/AmazonMSKFullAccess&quot;,
                    &quot;arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess&quot;
                ]
            }
        },
        &quot;EC2InstanceProfile&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::IAM::InstanceProfile&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;InstanceProfileName&quot;: &quot;EC2MSKCFProfile&quot;,
                &quot;Roles&quot;: [
                    <span>{</span>
                        &quot;Ref&quot;: &quot;EC2Role&quot;
                    }
                ]
            }
        },
        &quot;MSKCluster&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::MSK::Cluster&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;BrokerNodeGroupInfo&quot;: <span>{</span>
                    &quot;ClientSubnets&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
                        }
                    ],
                    &quot;InstanceType&quot;: &quot;kafka.m5.large&quot;,
                    &quot;SecurityGroups&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MSKSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    ],
                    &quot;StorageInfo&quot;: <span>{</span>
                        &quot;EBSStorageInfo&quot;: <span>{</span>
                            &quot;VolumeSize&quot;: 2000
                        }
                    }
                },
                &quot;ClusterName&quot;: &quot;MSKCluster&quot;,
                &quot;EncryptionInfo&quot;: <span>{</span>
                    &quot;EncryptionInTransit&quot;: <span>{</span>
                        &quot;ClientBroker&quot;: &quot;TLS&quot;,
                        &quot;InCluster&quot;: true
                    }
                },
                &quot;EnhancedMonitoring&quot;: &quot;PER_TOPIC_PER_BROKER&quot;,
                &quot;KafkaVersion&quot;: &quot;2.2.1&quot;,
                &quot;NumberOfBrokerNodes&quot;: 3
            }
        }
    },
    &quot;Outputs&quot;: <span>{</span>
        &quot;VPCId&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of the VPC created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;VPC&quot;
            }
        },
        &quot;PublicSubnetOne&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The name of the public subnet created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
            }
        },
        &quot;PrivateSubnetOne&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet one created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
            }
        },
        &quot;PrivateSubnetTwo&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet two created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
            }
        },
        &quot;PrivateSubnetThree&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet three created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
            }
        },
        &quot;MSKSecurityGroupID&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of the security group created for the MSK clusters&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;MSKSecurityGroup&quot;,
                    &quot;GroupId&quot;
                ]
            }
        },
        &quot;KafkaClientEC2InstancePublicDNS&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The Public DNS for the MirrorMaker EC2 instance&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;KafkaClientEC2Instance&quot;,
                    &quot;PublicDnsName&quot;
                ]
            }
        },
        &quot;MSKClusterArn&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The Arn for the MSKMMCluster1 MSK cluster&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;MSKCluster&quot;
            }
        }
    }
}</code></pre></div>
                                 <h3 id="aws-resource-msk-cluster--examples--Create_Two_MSK_Clusters_To_Use_With_Apache_MirrorMaker">Create Two MSK Clusters To Use With Apache MirrorMaker</h3>
                                 <p>This YAML shows how to set up two MSK clusters for MirrorMaker. It also sets up the
                                    Amazon
                                    VPC, subnets, security groups, and IAM roles that are necessary for this example.
                                    In
                                    addition, it creates an EC2 instance that has Apache Kafka, Java, and the AWS CLI.
                                    You can
                                    use this EC2 instance to run Apache Kafka tools, including MirrorMaker. You must manually
                                    create the MirrorMaker configuration files.
                                 </p>
                                 <div id="" name="" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_Two_MSK_Clusters_To_Use_With_Apache_MirrorMaker--YAML"></h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="YAML ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  KeyName:
    Description: The name of an existing EC2 KeyPair to enable SSH access to the instance.
    Type: &apos;AWS::EC2::KeyPair::KeyName&apos;
    ConstraintDescription: Can contain only ASCII characters.
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances.
    Type: String
    MinLength: &apos;9&apos;
    MaxLength: &apos;18&apos;
    Default: 0.0.0.0/0
    AllowedPattern: &apos;(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})&apos;
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x
Mappings:
  SubnetConfig:
    VPC:
      CIDR: 10.0.0.0/16
    PublicOne:
      CIDR: 10.0.0.0/24
    PrivateOne:
      CIDR: 10.0.1.0/24
    PrivateTwo:
      CIDR: 10.0.2.0/24
    PrivateThree:
      CIDR: 10.0.3.0/24
  RegionAMI:
    us-east-1:
      HVM64: ami-0c6b1d09930fac512
    us-west-2:
      HVM64: ami-0cb72367e98845d43
Resources:
  VPC:
    Type: &apos;AWS::EC2::VPC&apos;
    Properties:
      EnableDnsSupport: true
      EnableDnsHostnames: true
      CidrBlock: !FindInMap 
        - SubnetConfig
        - VPC
        - CIDR
      Tags:
        - Key: Name
          Value: MMVPC
  PublicSubnetOne:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PublicOne
        - CIDR
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: MMPublicSubnet
  PrivateSubnetOne:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateOne
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetOne
  PrivateSubnetTwo:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 1
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateTwo
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetTwo
  PrivateSubnetThree:
    Type: &apos;AWS::EC2::Subnet&apos;
    Properties:
      AvailabilityZone: !Select 
        - 2
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      VpcId: !Ref VPC
      CidrBlock: !FindInMap 
        - SubnetConfig
        - PrivateThree
        - CIDR
      Tags:
        - Key: Name
          Value: MMPrivateSubnetThree
  InternetGateway:
    Type: &apos;AWS::EC2::InternetGateway&apos;
  GatewayAttachement:
    Type: &apos;AWS::EC2::VPCGatewayAttachment&apos;
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
  PublicRouteTable:
    Type: &apos;AWS::EC2::RouteTable&apos;
    Properties:
      VpcId: !Ref VPC
  PublicRoute:
    Type: &apos;AWS::EC2::Route&apos;
    DependsOn: GatewayAttachement
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  PublicSubnetOneRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      SubnetId: !Ref PublicSubnetOne
      RouteTableId: !Ref PublicRouteTable
  PrivateRouteTable:
    Type: &apos;AWS::EC2::RouteTable&apos;
    Properties:
      VpcId: !Ref VPC
  PrivateSubnetOneRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetOne
  PrivateSubnetTwoRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetTwo
  PrivateSubnetThreeRouteTableAssociation:
    Type: &apos;AWS::EC2::SubnetRouteTableAssociation&apos;
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      SubnetId: !Ref PrivateSubnetThree
  MMInstanceSecurityGroup:
    Type: &apos;AWS::EC2::SecurityGroup&apos;
    Properties:
      GroupDescription: Enable SSH access via port 22
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation
  MSKSecurityGroup:
    Type: &apos;AWS::EC2::SecurityGroup&apos;
    Properties:
      GroupDescription: Enable SSH access via port 22
      VpcId: !Ref VPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 2181
          ToPort: 2181
          SourceSecurityGroupId: !GetAtt 
            - MMInstanceSecurityGroup
            - GroupId
        - IpProtocol: tcp
          FromPort: 9094
          ToPort: 9094
          SourceSecurityGroupId: !GetAtt 
            - MMInstanceSecurityGroup
            - GroupId
        - IpProtocol: tcp
          FromPort: 9092
          ToPort: 9092
          SourceSecurityGroupId: !GetAtt 
            - MMInstanceSecurityGroup
            - GroupId
  MMEC2Instance:
    Type: &apos;AWS::EC2::Instance&apos;
    Properties:
      InstanceType: m5.large
      KeyName: !Ref KeyName
      IamInstanceProfile: !Ref EC2InstanceProfile
      AvailabilityZone: !Select 
        - 0
        - !GetAZs 
          Ref: &apos;AWS::Region&apos;
      SubnetId: !Ref PublicSubnetOne
      SecurityGroupIds:
        - !GetAtt 
          - MMInstanceSecurityGroup
          - GroupId
      ImageId: !FindInMap 
        - RegionAMI
        - !Ref &apos;AWS::Region&apos;
        - HVM64
      Tags:
        - Key: Name
          Value: MMInstance
      UserData: !Base64 &gt;
        #!/bin/bash

        yum update -y 

        yum install python3.7 -y

        yum install java-1.8.0-openjdk-devel -y

        yum erase awscli -y

        cd /home/ec2-user

        echo &quot;export PATH=.local/bin:$PATH&quot; &gt;&gt; .bash_profile

        mkdir kafka

        mkdir mm

        cd kafka

        wget https://archive.apache.org/dist/kafka/2.2.1/kafka_2.12-2.2.1.tgz

        tar -xzf kafka_2.12-2.2.1.tgz

        cd /home/ec2-user

        wget https://bootstrap.pypa.io/get-pip.py

        su -c &quot;python3.7 get-pip.py --user&quot; -s /bin/sh ec2-user

        su -c &quot;/home/ec2-user/.local/bin/pip3 install boto3 --user&quot; -s /bin/sh
        ec2-user

        su -c &quot;/home/ec2-user/.local/bin/pip3 install awscli --user&quot; -s /bin/sh
        ec2-user

        chown -R ec2-user ./kafka

        chgrp -R ec2-user ./kafka

        chown -R ec2-user ./mm

        chgrp -R ec2-user ./mm
  EC2Role:
    Type: &apos;AWS::IAM::Role&apos;
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Sid: &apos;&apos;
            Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
            Action: &apos;sts:AssumeRole&apos;
      Path: /
      ManagedPolicyArns:
        - &apos;arn:aws:iam::aws:policy/AmazonMSKFullAccess&apos;
        - &apos;arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess&apos;
  EC2InstanceProfile:
    Type: &apos;AWS::IAM::InstanceProfile&apos;
    Properties:
      InstanceProfileName: EC2MSKCFProfile
      Roles:
        - !Ref EC2Role
  MSKMMCluster1:
    Type: &apos;AWS::MSK::Cluster&apos;
    Properties:
      BrokerNodeGroupInfo:
        ClientSubnets:
          - !Ref PrivateSubnetOne
          - !Ref PrivateSubnetTwo
          - !Ref PrivateSubnetThree
        InstanceType: kafka.m5.large
        SecurityGroups:
          - !GetAtt 
            - MSKSecurityGroup
            - GroupId
        StorageInfo:
          EBSStorageInfo:
            VolumeSize: 2000
      ClusterName: MSKMMCluster1
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
      EnhancedMonitoring: PER_TOPIC_PER_BROKER
      KafkaVersion: 2.2.1
      NumberOfBrokerNodes: 3
  MSKMMCluster2:
    Type: &apos;AWS::MSK::Cluster&apos;
    Properties:
      BrokerNodeGroupInfo:
        ClientSubnets:
          - !Ref PrivateSubnetOne
          - !Ref PrivateSubnetTwo
          - !Ref PrivateSubnetThree
        InstanceType: kafka.m5.large
        SecurityGroups:
          - !GetAtt 
            - MSKSecurityGroup
            - GroupId
        StorageInfo:
          EBSStorageInfo:
            VolumeSize: 2000
      ClusterName: MSKMMCluster2
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
      EnhancedMonitoring: PER_TOPIC_PER_BROKER
      KafkaVersion: 2.2.1
      NumberOfBrokerNodes: 3
Outputs:
  VPCId:
    Description: The ID of the VPC created
    Value: !Ref VPC
  PublicSubnetOne:
    Description: The name of the public subnet created
    Value: !Ref PublicSubnetOne
  PrivateSubnetOne:
    Description: The ID of private subnet one created
    Value: !Ref PrivateSubnetOne
  PrivateSubnetTwo:
    Description: The ID of private subnet two created
    Value: !Ref PrivateSubnetTwo
  PrivateSubnetThree:
    Description: The ID of private subnet three created
    Value: !Ref PrivateSubnetThree
  MSKSecurityGroupID:
    Description: The ID of the security group created for the MSK clusters
    Value: !GetAtt 
      - MSKSecurityGroup
      - GroupId
  MMEC2InstancePublicDNS:
    Description: The Public DNS for the MirrorMaker EC2 instance
    Value: !GetAtt 
      - MMEC2Instance
      - PublicDnsName
  MSKMMCluster1Arn:
    Description: The Arn for the MSKMMCluster1 MSK cluster
    Value: !Ref MSKMMCluster1
  MSKMMCluster2Arn:
    Description: The Arn for the MSKMMCluster2 MSK cluster
    Value: !Ref MSKMMCluster2</code></pre></div>
                                 <div id="" name="" class="section langfilter">
                                    <h4 id="aws-resource-msk-cluster--examples--Create_Two_MSK_Clusters_To_Use_With_Apache_MirrorMaker--JSON"></h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
    &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
    &quot;Parameters&quot;: <span>{</span>
        &quot;KeyName&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The name of an existing EC2 KeyPair to enable SSH access to the instance.&quot;,
            &quot;Type&quot;: &quot;AWS::EC2::KeyPair::KeyName&quot;,
            &quot;ConstraintDescription&quot;: &quot;Can contain only ASCII characters.&quot;
        },
        &quot;SSHLocation&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The IP address range that can be used to SSH to the EC2 instances.&quot;,
            &quot;Type&quot;: &quot;String&quot;,
            &quot;MinLength&quot;: &quot;9&quot;,
            &quot;MaxLength&quot;: &quot;18&quot;,
            &quot;Default&quot;: &quot;0.0.0.0/0&quot;,
            &quot;AllowedPattern&quot;: &quot;(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})&quot;,
            &quot;ConstraintDescription&quot;: &quot;Must be a valid IP CIDR range of the form x.x.x.x/x&quot;
        }
    },
    &quot;Mappings&quot;: <span>{</span>
        &quot;SubnetConfig&quot;: <span>{</span>
            &quot;VPC&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.0.0/16&quot;
            },
            &quot;PublicOne&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.0.0/24&quot;
            },
            &quot;PrivateOne&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.1.0/24&quot;
            },
            &quot;PrivateTwo&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.2.0/24&quot;
            },
            &quot;PrivateThree&quot;: <span>{</span>
                &quot;CIDR&quot;: &quot;10.0.3.0/24&quot;
            }
        },
        &quot;RegionAMI&quot;: <span>{</span>
            &quot;us-east-1&quot;: <span>{</span>
                &quot;HVM64&quot;: &quot;ami-0c6b1d09930fac512&quot;
            },
            &quot;us-west-2&quot;: <span>{</span>
                &quot;HVM64&quot;: &quot;ami-0cb72367e98845d43&quot;
            }
        }
    },
    &quot;Resources&quot;: <span>{</span>
        &quot;VPC&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::VPC&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;EnableDnsSupport&quot;: true,
                &quot;EnableDnsHostnames&quot;: true,
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;VPC&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMVPC&quot;
                    }
                ]
            }
        },
        &quot;PublicSubnetOne&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PublicOne&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;MapPublicIpOnLaunch&quot;: true,
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPublicSubnet&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetOne&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateOne&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetOne&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetTwo&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        1,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateTwo&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetTwo&quot;
                    }
                ]
            }
        },
        &quot;PrivateSubnetThree&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        2,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;CidrBlock&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;SubnetConfig&quot;,
                        &quot;PrivateThree&quot;,
                        &quot;CIDR&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMPrivateSubnetThree&quot;
                    }
                ]
            }
        },
        &quot;InternetGateway&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::InternetGateway&quot;
        },
        &quot;GatewayAttachement&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::VPCGatewayAttachment&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;InternetGatewayId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;InternetGateway&quot;
                }
            }
        },
        &quot;PublicRouteTable&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::RouteTable&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                }
            }
        },
        &quot;PublicRoute&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Route&quot;,
            &quot;DependsOn&quot;: &quot;GatewayAttachement&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicRouteTable&quot;
                },
                &quot;DestinationCidrBlock&quot;: &quot;0.0.0.0/0&quot;,
                &quot;GatewayId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;InternetGateway&quot;
                }
            }
        },
        &quot;PublicSubnetOneRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
                },
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicRouteTable&quot;
                }
            }
        },
        &quot;PrivateRouteTable&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::RouteTable&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                }
            }
        },
        &quot;PrivateSubnetOneRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
                }
            }
        },
        &quot;PrivateSubnetTwoRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
                }
            }
        },
        &quot;PrivateSubnetThreeRouteTableAssociation&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SubnetRouteTableAssociation&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;RouteTableId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateRouteTable&quot;
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
                }
            }
        },
        &quot;MMInstanceSecurityGroup&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SecurityGroup&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;GroupDescription&quot;: &quot;Enable SSH access via port 22&quot;,
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;SecurityGroupIngress&quot;: [
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 22,
                        &quot;ToPort&quot;: 22,
                        &quot;CidrIp&quot;: <span>{</span>
                            &quot;Ref&quot;: &quot;SSHLocation&quot;
                        }
                    }
                ]
            }
        },
        &quot;MSKSecurityGroup&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::SecurityGroup&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;GroupDescription&quot;: &quot;Enable SSH access via port 22&quot;,
                &quot;VpcId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;VPC&quot;
                },
                &quot;SecurityGroupIngress&quot;: [
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 2181,
                        &quot;ToPort&quot;: 2181,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MMInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    },
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 9094,
                        &quot;ToPort&quot;: 9094,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MMInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    },
                    <span>{</span>
                        &quot;IpProtocol&quot;: &quot;tcp&quot;,
                        &quot;FromPort&quot;: 9092,
                        &quot;ToPort&quot;: 9092,
                        &quot;SourceSecurityGroupId&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MMInstanceSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    }
                ]
            }
        },
        &quot;MMEC2Instance&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::EC2::Instance&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;InstanceType&quot;: &quot;m5.large&quot;,
                &quot;KeyName&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;KeyName&quot;
                },
                &quot;IamInstanceProfile&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;EC2InstanceProfile&quot;
                },
                &quot;AvailabilityZone&quot;: <span>{</span>
                    &quot;Fn::Select&quot;: [
                        0,
                        <span>{</span>
                            &quot;Fn::GetAZs&quot;: <span>{</span>
                                &quot;Ref&quot;: &quot;AWS::Region&quot;
                            }
                        }
                    ]
                },
                &quot;SubnetId&quot;: <span>{</span>
                    &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
                },
                &quot;SecurityGroupIds&quot;: [
                    <span>{</span>
                        &quot;Fn::GetAtt&quot;: [
                            &quot;MMInstanceSecurityGroup&quot;,
                            &quot;GroupId&quot;
                        ]
                    }
                ],
                &quot;ImageId&quot;: <span>{</span>
                    &quot;Fn::FindInMap&quot;: [
                        &quot;RegionAMI&quot;,
                        <span>{</span>
                            &quot;Ref&quot;: &quot;AWS::Region&quot;
                        },
                        &quot;HVM64&quot;
                    ]
                },
                &quot;Tags&quot;: [
                    <span>{</span>
                        &quot;Key&quot;: &quot;Name&quot;,
                        &quot;Value&quot;: &quot;MMInstance&quot;
                    }
                ],
                &quot;UserData&quot;: <span>{</span>
                    &quot;Fn::Base64&quot;: &quot;#!/bin/bash\nyum update -y \nyum install python3.7 -y\nyum install java-1.8.0-openjdk-devel -y\nyum erase awscli -y\ncd /home/ec2-user\necho \&quot;export PATH=.local/bin:$PATH\&quot; &gt;&gt; .bash_profile\nmkdir kafka\nmkdir mm\ncd kafka\nwget https://archive.apache.org/dist/kafka/2.2.1/kafka_2.12-2.2.1.tgz\ntar -xzf kafka_2.12-2.2.1.tgz\ncd /home/ec2-user\nwget https://bootstrap.pypa.io/get-pip.py\nsu -c \&quot;python3.7 get-pip.py --user\&quot; -s /bin/sh ec2-user\nsu -c \&quot;/home/ec2-user/.local/bin/pip3 install boto3 --user\&quot; -s /bin/sh ec2-user\nsu -c \&quot;/home/ec2-user/.local/bin/pip3 install awscli --user\&quot; -s /bin/sh ec2-user\nchown -R ec2-user ./kafka\nchgrp -R ec2-user ./kafka\nchown -R ec2-user ./mm\nchgrp -R ec2-user ./mm\n&quot;
                }
            }
        },
        &quot;EC2Role&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::IAM::Role&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;AssumeRolePolicyDocument&quot;: <span>{</span>
                    &quot;Version&quot;: &quot;2012-10-17&quot;,
                    &quot;Statement&quot;: [
                        <span>{</span>
                            &quot;Sid&quot;: &quot;&quot;,
                            &quot;Effect&quot;: &quot;Allow&quot;,
                            &quot;Principal&quot;: <span>{</span>
                                &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;
                            },
                            &quot;Action&quot;: &quot;sts:AssumeRole&quot;
                        }
                    ]
                },
                &quot;Path&quot;: &quot;/&quot;,
                &quot;ManagedPolicyArns&quot;: [
                    &quot;arn:aws:iam::aws:policy/AmazonMSKFullAccess&quot;,
                    &quot;arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess&quot;
                ]
            }
        },
        &quot;EC2InstanceProfile&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::IAM::InstanceProfile&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;InstanceProfileName&quot;: &quot;EC2MSKCFProfile&quot;,
                &quot;Roles&quot;: [
                    <span>{</span>
                        &quot;Ref&quot;: &quot;EC2Role&quot;
                    }
                ]
            }
        },
        &quot;MSKMMCluster1&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::MSK::Cluster&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;BrokerNodeGroupInfo&quot;: <span>{</span>
                    &quot;ClientSubnets&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
                        }
                    ],
                    &quot;InstanceType&quot;: &quot;kafka.m5.large&quot;,
                    &quot;SecurityGroups&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MSKSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    ],
                    &quot;StorageInfo&quot;: <span>{</span>
                        &quot;EBSStorageInfo&quot;: <span>{</span>
                            &quot;VolumeSize&quot;: 2000
                        }
                    }
                },
                &quot;ClusterName&quot;: &quot;MSKMMCluster1&quot;,
                &quot;EncryptionInfo&quot;: <span>{</span>
                    &quot;EncryptionInTransit&quot;: <span>{</span>
                        &quot;ClientBroker&quot;: &quot;TLS&quot;,
                        &quot;InCluster&quot;: true
                    }
                },
                &quot;EnhancedMonitoring&quot;: &quot;PER_TOPIC_PER_BROKER&quot;,
                &quot;KafkaVersion&quot;: &quot;2.2.1&quot;,
                &quot;NumberOfBrokerNodes&quot;: 3
            }
        },
        &quot;MSKMMCluster2&quot;: <span>{</span>
            &quot;Type&quot;: &quot;AWS::MSK::Cluster&quot;,
            &quot;Properties&quot;: <span>{</span>
                &quot;BrokerNodeGroupInfo&quot;: <span>{</span>
                    &quot;ClientSubnets&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
                        }
                    ],
                    &quot;InstanceType&quot;: &quot;kafka.m5.large&quot;,
                    &quot;SecurityGroups&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;MSKSecurityGroup&quot;,
                                &quot;GroupId&quot;
                            ]
                        }
                    ],
                    &quot;StorageInfo&quot;: <span>{</span>
                        &quot;EBSStorageInfo&quot;: <span>{</span>
                            &quot;VolumeSize&quot;: 2000
                        }
                    }
                },
                &quot;ClusterName&quot;: &quot;MSKMMCluster2&quot;,
                &quot;EncryptionInfo&quot;: <span>{</span>
                    &quot;EncryptionInTransit&quot;: <span>{</span>
                        &quot;ClientBroker&quot;: &quot;TLS&quot;,
                        &quot;InCluster&quot;: true
                    }
                },
                &quot;EnhancedMonitoring&quot;: &quot;PER_TOPIC_PER_BROKER&quot;,
                &quot;KafkaVersion&quot;: &quot;2.2.1&quot;,
                &quot;NumberOfBrokerNodes&quot;: 3
            }
        }
    },
    &quot;Outputs&quot;: <span>{</span>
        &quot;VPCId&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of the VPC created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;VPC&quot;
            }
        },
        &quot;PublicSubnetOne&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The name of the public subnet created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PublicSubnetOne&quot;
            }
        },
        &quot;PrivateSubnetOne&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet one created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetOne&quot;
            }
        },
        &quot;PrivateSubnetTwo&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet two created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetTwo&quot;
            }
        },
        &quot;PrivateSubnetThree&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of private subnet three created&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;PrivateSubnetThree&quot;
            }
        },
        &quot;MSKSecurityGroupID&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The ID of the security group created for the MSK clusters&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;MSKSecurityGroup&quot;,
                    &quot;GroupId&quot;
                ]
            }
        },
        &quot;MMEC2InstancePublicDNS&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The Public DNS for the MirrorMaker EC2 instance&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Fn::GetAtt&quot;: [
                    &quot;MMEC2Instance&quot;,
                    &quot;PublicDnsName&quot;
                ]
            }
        },
        &quot;MSKMMCluster1Arn&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The Arn for the MSKMMCluster1 MSK cluster&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;MSKMMCluster1&quot;
            }
        },
        &quot;MSKMMCluster2Arn&quot;: <span>{</span>
            &quot;Description&quot;: &quot;The Arn for the MSKMMCluster2 MSK cluster&quot;,
            &quot;Value&quot;: <span>{</span>
                &quot;Ref&quot;: &quot;MSKMMCluster2&quot;
            }
        }
    }
}</code></pre></div>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning"> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser&apos;s Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div></div>
</body>
</html>