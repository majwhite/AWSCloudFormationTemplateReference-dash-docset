<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="aws-resource-secretsmanager-secrettargetattachment">AWS::SecretsManager::SecretTargetAttachment</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The <code class="code">AWS::SecretsManager::SecretTargetAttachment</code> resource completes the final
                                    link between a Secrets Manager secret and the associated database. This is required
                                    because
                                    each has a dependency on the other. No matter which one you create first, the other
                                    doesn&apos;t
                                    exist yet. To resolve this, you must create the resources in the following order:
                                 </p>
                                 <div class="orderedlist">
                                     
                                     
                                     
                                    
                                    <ol>
                                       <li>
                                          
                                          <p>Define the secret without referencing the service or database. You can&apos;t reference
                                             the
                                             service or database because it doesn&apos;t exist yet.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Next, define the service or database. Include the reference to the secret to use
                                             stored credentials to define the database master user and password.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Finally, define a <code class="code">SecretTargetAttachment</code> resource type to finish
                                             configuring the secret with the required database engine type and the connection details
                                             of the service or database. The rotation function requires the details, if you attach
                                             one
                                             later by defining a <a href="aws-resource-secretsmanager-rotationschedule.html">AWS::SecretsManager::RotationSchedule</a> resource type.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 <h2 id="aws-resource-secretsmanager-secrettargetattachment-syntax">Syntax</h2>
                                 <p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h3 id="aws-resource-secretsmanager-secrettargetattachment-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  &quot;Type&quot; : &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
  &quot;Properties&quot; : <span>{</span>
      &quot;<a href="#cfn-secretsmanager-secrettargetattachment-secretid">SecretId</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-secretsmanager-secrettargetattachment-targetid">TargetId</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-secretsmanager-secrettargetattachment-targettype">TargetType</a>&quot; : <code class="replaceable">String</code>
    }
}
</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h3 id="aws-resource-secretsmanager-secrettargetattachment-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::SecretsManager::SecretTargetAttachment
Properties: 
  <a href="#cfn-secretsmanager-secrettargetattachment-secretid">SecretId</a>: <code class="replaceable">String</code>
  <a href="#cfn-secretsmanager-secrettargetattachment-targetid">TargetId</a>: <code class="replaceable">String</code>
  <a href="#cfn-secretsmanager-secrettargetattachment-targettype">TargetType</a>: <code class="replaceable">String</code>
</code></pre></div>
                                 <h2 id="aws-resource-secretsmanager-secrettargetattachment-properties">Properties</h2>
                                 <div class="variablelist">
                                    <dl>
                                       <dt><a id="cfn-secretsmanager-secrettargetattachment-secretid"></a><span class="term"><code class="code">SecretId</code></span></dt>
                                       <dd>
                                          
                                          <p>The Amazon Resource Name (ARN) or the friendly name of the secret that contains the
                                             credentials that you want to use with the specified service or database. To reference
                                             a secret
                                             also created in this template, use the see <a href="intrinsic-function-reference-ref.html">Ref</a>
                                             function with the secret&apos;s logical ID.
                                          </p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-secretsmanager-secrettargetattachment-targetid"></a><span class="term"><code class="code">TargetId</code></span></dt>
                                       <dd>
                                          
                                          <p>The ARN of the service or database credentials stored in the specified secret.</p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Minimum</em>: <code class="code">20</code></p>
                                          <p><em>Maximum</em>: <code class="code">2048</code></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-secretsmanager-secrettargetattachment-targettype"></a><span class="term"><code class="code">TargetType</code></span></dt>
                                       <dd>
                                          
                                          <p>A string that defines the type of service or database associated with the secret.
                                             This
                                             value instructs AWS Secrets Manager how to update the secret with the details of the
                                             service
                                             or database. This value must be one of the following: 
                                          </p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p>AWS::RDS::DBInstance</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>AWS::RDS::DBCluster</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>AWS::Redshift::Cluster</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>AWS::DocDB::DBInstance</p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>AWS::DocDB::DBCluster</p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                    </dl>
                                 </div>
                                 <h2 id="aws-resource-secretsmanager-secrettargetattachment-return-values">Return values</h2>
                                 <h3 id="aws-resource-secretsmanager-secrettargetattachment-return-values-ref">Ref</h3>
                                 <p>When you pass the logical ID of an
                                    <code class="code">AWS::SecretsManager::SecretTargetAttachement</code> resource to the intrinsic
                                    <code class="code">Ref</code> function, the function returns the ARN of the secret, such as:
                                 </p>
                                 <p><code class="code">arn:aws:secretsmanager:us-west-2:123456789012:secret:my-path/my-secret-name-1a2b3c</code></p>
                                 <p>This enables you to reference a secret you created in one part of the stack template
                                    from
                                    within the definition of another resource from a different part of the same template.
                                 </p>
                                 <p>For more information about using the <code class="code">Ref</code> function, see <a href="intrinsic-function-reference-ref.html">Ref</a>. 
                                 </p>
                                 <h2 id="aws-resource-secretsmanager-secrettargetattachment--examples">Examples</h2>
                                 <p>The following examples create a secret, and then creates an AWS resource as defined
                                    by
                                    the TargetType by using the credentials found in the secret for the new AWS resource
                                    master
                                    user and password. Finally, the code updates the secret with the connection details
                                    of the
                                    AWS resource by defining the <code class="code">SecretTargetAttachment</code> object.
                                 </p>
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Supported AWS Resources</b></p>
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Amazon Aurora on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>MySQL on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>PostgresSQL on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Oracle on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>MariaDB on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Microsoft SQL Server on Amazon RDS</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Amazon DocumentDB</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Amazon Redshift</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>The JSON specification doesn&apos;t allow any kind of comments. See the YAML examples for
                                          comments.
                                       </p>
                                    </div>
                                 </div>
                                 <h3 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Secret_on_a_RDS_Database_Instance">Creating a Secret on a RDS Database Instance</h3>
                                 <p>This example template creates a RDS database and secret.</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Secret_on_a_RDS_Database_Instance--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  &quot;MyRDSSecret&quot;: <span>{</span>
    &quot;Type&quot;: &quot;AWS::SecretsManager::Secret&quot;,
    &quot;Properties&quot;: <span>{</span>
      &quot;Description&quot;: &quot;This is a Secrets Manager secret for an RDS DB instance&quot;,
      &quot;GenerateSecretString&quot;: <span>{</span>
        &quot;SecretStringTemplate&quot;: &quot;<span>{</span>\&quot;username\&quot;: \&quot;admin\&quot;}&quot;,
        &quot;GenerateStringKey&quot;: &quot;password&quot;,
        &quot;PasswordLength&quot;: 16,
        &quot;ExcludeCharacters&quot;: &quot;\&quot;@/\\&quot;
      }
    }
  },
  &quot;MyRDSInstance&quot;: <span>{</span>
    &quot;Type&quot;: &quot;AWS::RDS::DBInstance&quot;,
    &quot;Properties&quot;: <span>{</span>
      &quot;AllocatedStorage&quot;: &quot;&#x2019;20&#x2019;&quot;,
      &quot;DBInstanceClass&quot;: &quot;db.t2.micro&quot;,
      &quot;Engine&quot;: &quot;mysql&quot;,
      &quot;MasterUsername&quot;: <span>{</span>&quot;Fn::Join&quot;: [&quot;&quot;, [&quot;<span>{</span><span>{</span>resolve:secretsmanager:&quot;,<span>{</span>&quot;Ref&quot;: &quot;MyRDSSecret&quot;},&quot;:SecretString:username}}&quot;] ] },
      &quot;MasterUserPassword&quot;: <span>{</span>&quot;Fn::Join&quot;: [&quot;&quot;, [&quot;<span>{</span><span>{</span>resolve:secretsmanager:&quot;,<span>{</span>&quot;Ref&quot;: &quot;MyRDSSecret&quot;},&quot;:SecretString:password}}&quot;] ] },
      &quot;BackupRetentionPeriod&quot;: 0,
      &quot;DBInstanceIdentifier&quot;: &quot;rotation-instance&quot;
    }
  },
  &quot;SecretRDSInstanceAttachment&quot;: <span>{</span>
    &quot;Type&quot;: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
    &quot;Properties&quot;: <span>{</span>
      &quot;SecretId&quot;: <span>{</span>&quot;Ref&quot;: &quot;MyRDSSecret&quot;},
      &quot;TargetId&quot;: <span>{</span>&quot;Ref&quot;: &quot;MyRDSInstance&quot;},
      &quot;TargetType&quot;: &quot;AWS::RDS::DBInstance&quot;
    }
  }
}
</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Secret_on_a_RDS_Database_Instance--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">#This is a Secret resource with a randomly generated password in its SecretString JSON.
  MyRDSSecret:
    Type: &quot;AWS::SecretsManager::Secret&quot;
    Properties:
      Description: &quot;This is a Secrets Manager secret for an RDS DB instance&quot;
      GenerateSecretString:
        SecretStringTemplate: &apos;<span>{</span>&quot;username&quot;: &quot;admin&quot;}&apos;
        GenerateStringKey: &quot;password&quot;
        PasswordLength: 16
        ExcludeCharacters: &apos;&quot;@/\&apos;

  # This is an RDS instance resource. The master username and password use dynamic references
  # to resolve values from Secrets Manager. The dynamic reference guarantees that CloudFormation
  # will not log or persist the resolved value. We use a Ref to the secret resource&apos;s logical id
  # to construct the dynamic reference, since the secret name is generated by CloudFormation.
  MyRDSInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      AllocatedStorage: 20
      DBInstanceClass: db.t2.micro
      Engine: mysql
      MasterUsername: !Join [&apos;&apos;, [&apos;<span>{</span><span>{</span>resolve:secretsmanager:&apos;, !Ref MyRDSSecret, &apos;:SecretString:username}}&apos; ]]
      MasterUserPassword: !Join [&apos;&apos;, [&apos;<span>{</span><span>{</span>resolve:secretsmanager:&apos;, !Ref MyRDSSecret, &apos;:SecretString:password}}&apos; ]]
      BackupRetentionPeriod: 0
      DBInstanceIdentifier: &apos;rotation-instance&apos;

  #This is a SecretTargetAttachment resource which updates the referenced Secret resource with properties about
  #the referenced RDS instance
  SecretRDSInstanceAttachment:
    Type: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;
    Properties:
      SecretId: !Ref MyRDSSecret
      TargetId: !Ref MyRDSInstance
      TargetType: AWS::RDS::DBInstance</code></pre></div>
                                 <h3 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Secret_on_a_Redshift_Cluster">Creating a Secret on a Redshift Cluster</h3>
                                 <p>This example template creates a Redshift Cluster database and secret.</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Secret_on_a_Redshift_Cluster--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
      &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
      &quot;Resources&quot;: <span>{</span>
        &quot;MyRedshiftSecret&quot;: <span>{</span>
          &quot;Type&quot;: &quot;AWS::SecretsManager::Secret&quot;,
          &quot;Properties&quot;: <span>{</span>
            &quot;Description&quot;: &quot;This is a Secrets Manager secret for a Redshift cluster&quot;,
            &quot;GenerateSecretString&quot;: <span>{</span>
              &quot;SecretStringTemplate&quot;: &quot;<span>{</span>\&quot;username\&quot;: \&quot;admin\&quot;}&quot;,
              &quot;GenerateStringKey&quot;: &quot;password&quot;,
              &quot;PasswordLength&quot;: 16,
              &quot;ExcludeCharacters&quot;: &quot;\&quot;&apos;@/\\&quot;
            }
          }
        },
        &quot;MyRedshiftCluster&quot;: <span>{</span>
          &quot;Type&quot;: &quot;AWS::Redshift::Cluster&quot;,
          &quot;Properties&quot;: <span>{</span>
            &quot;DBName&quot;: &quot;myjsondb&quot;,
            &quot;MasterUsername&quot;: <span>{</span>&quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::username}}&quot;},
            &quot;MasterUserPassword&quot;: <span>{</span>&quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::password}}&quot;},
            &quot;NodeType&quot;: &quot;ds2.xlarge&quot;,
            &quot;ClusterType&quot;: &quot;single-node&quot;
          }
        },
        &quot;SecretRedshiftAttachment&quot;: <span>{</span>
          &quot;Type&quot;: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
          &quot;Properties&quot;: <span>{</span>
            &quot;SecretId&quot;: <span>{</span>&quot;Ref&quot;: &quot;MyRedshiftSecret&quot;},
            &quot;TargetId&quot;: <span>{</span>&quot;Ref&quot;: &quot;MyRedshiftCluster&quot;},
            &quot;TargetType&quot;: &quot;AWS::Redshift::Cluster&quot;
          }
        }
      }
    }</code></pre></div>
                                 <h3 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Redshift_Cluster_using_YAML">Creating a Redshift Cluster using YAML</h3>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-secrettargetattachment--examples--Creating_a_Redshift_Cluster_using_YAML--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
    Description: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager.
    Resources:
      #This is a Secret resource with a randomly generated password in its SecretString JSON.
      MyRedshiftSecret:
        Type: &quot;AWS::SecretsManager::Secret&quot;
        Properties:
          Description: &quot;This is a Secrets Manager secret for an Redshift cluster&quot;
          GenerateSecretString:
            SecretStringTemplate: &apos;<span>{</span>&quot;username&quot;: &quot;admin&quot;}&apos;
            GenerateStringKey: &quot;password&quot;
            PasswordLength: 16
            ExcludeCharacters: &quot;\&quot;@&apos;/\\&quot;
     
      # This is a Redshift cluster resource. The master username and password use dynamic references
      # to resolve values from Secrets Manager. The dynamic reference guarantees that CloudFormation
      # will not log or persist the resolved value. We use a Ref to the secret resource&apos;s logical id
      # to construct the dynamic reference, since the secret name is generated by CloudFormation.
      MyRedshiftCluster:
        Type: AWS::Redshift::Cluster
        Properties:
          DBName: &quot;myyamldb&quot;
          MasterUsername: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::username}}&apos;
          MasterUserPassword: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::password}}&apos;
          NodeType: &quot;ds2.xlarge&quot;
          ClusterType: &quot;single-node&quot;
     
      # This is a SecretTargetAttachment resource which updates the referenced Secret resource with properties about
      # the referenced Redshift cluster
      SecretRedshiftAttachment:
        Type: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;
        Properties:
          SecretId: !Ref MyRedshiftSecret
          TargetId: !Ref MyRedshiftCluster
          TargetType: AWS::Redshift::Cluster</code></pre></div>
                                 <h2 id="aws-resource-secretsmanager-secrettargetattachment--seealso">See also</h2>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>
                                             <a href="aws-resource-secretsmanager-secret.html">AWS::SecretsManager::Secret</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>
                                             <a href="aws-resource-secretsmanager-rotationschedule.html">AWS::SecretsManager::RotationSchedule</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>
                                             <a href="aws-resource-secretsmanager-resourcepolicy.html">AWS::SecretsManager::ResourcePolicy</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning"> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser&apos;s Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div></div>
</body>
</html>