<!DOCTYPE html>
<html>
<head>
    <link href="css/awsdocs.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/awsdocs.min.js"></script>
    <meta charset="utf-8">
</head>
<body>
    <div id="content" style="padding: 10px 30px;">
    <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="aws-resource-secretsmanager-rotationschedule">AWS::SecretsManager::RotationSchedule</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The <code class="code">AWS::SecretsManager::RotationSchedule</code> resource configures rotation for a
                                    secret. You must already configure the secret with the details of the database or
                                    service. If you define both the secret and the database or service in an AWS CloudFormation
                                    template, then define the <a href="aws-resource-secretsmanager-secrettargetattachment.html">AWS::SecretsManager::SecretTargetAttachment</a> resource to populate the secret with
                                    the connection details of the database or service before you attempt to configure
                                    rotation.
                                 </p>
                                 <div class="awsdocs-note awsdocs-important">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-warning" variant="error"></awsui-icon><span>Important</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>When you configure rotation for a secret, AWS CloudFormation automatically rotates
                                          the
                                          secret one time. Be sure you configure all your clients to retrieve the secret using
                                          Secrets
                                          Manager before configuring rotation to prevent breaking them.
                                       </p>
                                    </div>
                                 </div>
                                 <h2 id="aws-resource-secretsmanager-rotationschedule-syntax">Syntax</h2>
                                 <p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h3 id="aws-resource-secretsmanager-rotationschedule-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  &quot;Type&quot; : &quot;AWS::SecretsManager::RotationSchedule&quot;,
  &quot;Properties&quot; : <span>{</span>
      &quot;<a href="#cfn-secretsmanager-rotationschedule-hostedrotationlambda">HostedRotationLambda</a>&quot; : <code class="replaceable"><a href="./aws-properties-secretsmanager-rotationschedule-hostedrotationlambda.html">HostedRotationLambda</a></code>,
      &quot;<a href="#cfn-secretsmanager-rotationschedule-rotationlambdaarn">RotationLambdaARN</a>&quot; : <code class="replaceable">String</code>,
      &quot;<a href="#cfn-secretsmanager-rotationschedule-rotationrules">RotationRules</a>&quot; : <code class="replaceable"><a href="./aws-properties-secretsmanager-rotationschedule-rotationrules.html">RotationRules</a></code>,
      &quot;<a href="#cfn-secretsmanager-rotationschedule-secretid">SecretId</a>&quot; : <code class="replaceable">String</code>
    }
}
</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h3 id="aws-resource-secretsmanager-rotationschedule-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::SecretsManager::RotationSchedule
Properties: 
  <a href="#cfn-secretsmanager-rotationschedule-hostedrotationlambda">HostedRotationLambda</a>: <code class="replaceable">
    <a href="./aws-properties-secretsmanager-rotationschedule-hostedrotationlambda.html">HostedRotationLambda</a></code>
  <a href="#cfn-secretsmanager-rotationschedule-rotationlambdaarn">RotationLambdaARN</a>: <code class="replaceable">String</code>
  <a href="#cfn-secretsmanager-rotationschedule-rotationrules">RotationRules</a>: <code class="replaceable">
    <a href="./aws-properties-secretsmanager-rotationschedule-rotationrules.html">RotationRules</a></code>
  <a href="#cfn-secretsmanager-rotationschedule-secretid">SecretId</a>: <code class="replaceable">String</code>
</code></pre></div>
                                 <h2 id="aws-resource-secretsmanager-rotationschedule-properties">Properties</h2>
                                 <div class="variablelist">
                                    <dl>
                                       <dt><a id="cfn-secretsmanager-rotationschedule-hostedrotationlambda"></a><span class="term"><code class="code">HostedRotationLambda</code></span></dt>
                                       <dd>
                                          
                                          <p>To use these values, you must specify <code class="code">Transform:
                                                AWS::SecretsManager-2020-07-23</code> at the beginning of the CloudFormation
                                             template.
                                          </p>
                                          
                                          <p>When you enter valid values for <code class="code">RotationSchedule.HostedRotationLambda</code>,
                                             Secrets Manager launches a Lambda that performs rotation on the secret specified in
                                             the
                                             <code class="code">secret-id</code> property. The template creates a Lambda as part of a nested stack
                                             within the current stack. 
                                          </p>
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-secretsmanager-rotationschedule-hostedrotationlambda.html">HostedRotationLambda</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-secretsmanager-rotationschedule-rotationlambdaarn"></a><span class="term"><code class="code">RotationLambdaARN</code></span></dt>
                                       <dd>
                                          
                                          <p>Specifies the ARN of the Lambda function that can rotate the secret. If you don&apos;t
                                             specify
                                             this parameter, then the secret must already have the ARN of a Lambda function configured.
                                             To
                                             reference a Lambda function also created in this template, use the <a href="intrinsic-function-reference-ref.html">Ref</a>
                                             function with the function&apos;s logical ID.
                                          </p>
                                          
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-secretsmanager-rotationschedule-rotationrules"></a><span class="term"><code class="code">RotationRules</code></span></dt>
                                       <dd>
                                          
                                          <p>Specifies a structure that defines the rotation schedule for this secret.</p>
                                          
                                          <p><em>Required</em>: No
                                          </p>
                                          <p><em>Type</em>: <a href="./aws-properties-secretsmanager-rotationschedule-rotationrules.html">RotationRules</a></p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p>
                                       </dd>
                                       <dt><a id="cfn-secretsmanager-rotationschedule-secretid"></a><span class="term"><code class="code">SecretId</code></span></dt>
                                       <dd>
                                          
                                          <p>Specifies the ARN or the friendly name of the secret that you want to rotate. To reference
                                             a secret also created in this template, use the <a href="intrinsic-function-reference-ref.html">Ref</a>
                                             function with the secret&apos;s logical ID.
                                          </p>
                                          
                                          <p><em>Required</em>: Yes
                                          </p>
                                          <p><em>Type</em>: String
                                          </p>
                                          <p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p>
                                       </dd>
                                    </dl>
                                 </div>
                                 <h2 id="aws-resource-secretsmanager-rotationschedule-return-values">Return values</h2>
                                 <h3 id="aws-resource-secretsmanager-rotationschedule-return-values-ref">Ref</h3>
                                 <p>When you pass the logical ID of an <code class="code">AWS::SecretsManager::RotationSchedule</code>
                                    resource to the intrinsic <code class="code">Ref</code> function, the function returns the ARN of the
                                    secret being configured, such as:
                                 </p>
                                 <p><em>arn:aws:secretsmanager:
                                       us-west-2</em>:<em>123456789012</em>:secret:<em>my-path/my-secret-name</em>-<em>1a2b3c</em>
                                    
                                 </p>
                                 <p>This enables you to reference a secret you create in one part of the stack template
                                    from
                                    within the definition of another resource later, in the same template. You typically
                                    do this
                                    when you define the <a href="aws-resource-secretsmanager-secrettargetattachment.html">AWS::SecretsManager::SecretTargetAttachment</a> resource type.
                                 </p>
                                 <p>For more information about using the <code class="code">Ref</code> function, see <a href="intrinsic-function-reference-ref.html">Ref</a>.
                                    
                                 </p>
                                 <h2 id="aws-resource-secretsmanager-rotationschedule--examples">Examples</h2>
                                 <p>The following examples display complete examples of creating a secret, creating an
                                    RDS
                                    database instance associated with the secret and configuring rotation. The example
                                    shows how
                                    to define a Lambda rotation function, attach the required trust and permissions policies,
                                    and associate the function with the secret on a defined schedule.
                                 </p>
                                 <p>RDS Secret Rotation</p>
                                 <h3 id="aws-resource-secretsmanager-rotationschedule--examples--Configuring_RDS_DB_Secret_Rotation">Configuring RDS DB Secret Rotation</h3>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--Configuring_RDS_DB_Secret_Rotation--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
        &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
        &quot;Transform&quot;: &quot;AWS::SecretsManager-2020-07-23&quot;,
        &quot;Description&quot;: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot;,
        &quot;Resources&quot;: <span>{</span>
            &quot;TestVPC&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPC&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.0.0/16&quot;,
                    &quot;EnableDnsHostnames&quot;: true,
                    &quot;EnableDnsSupport&quot;: true
                }
            },
            &quot;TestSubnet01&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.96.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;0&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;TestSubnet02&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.128.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;1&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;SecretsManagerVPCEndpoint&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPCEndpoint&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ],
                    &quot;SecurityGroupIds&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ],
                    &quot;VpcEndpointType&quot;: &quot;Interface&quot;,
                    &quot;ServiceName&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
                    },
                    &quot;PrivateDnsEnabled&quot;: true,
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;MyRDSInstanceRotationSecret&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::Secret&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;Description&quot;: &quot;This is my rds instance secret&quot;,
                    &quot;GenerateSecretString&quot;: <span>{</span>
                        &quot;SecretStringTemplate&quot;: &quot;<span>{</span>\&quot;username\&quot;: \&quot;admin\&quot;}&quot;,
                        &quot;GenerateStringKey&quot;: &quot;password&quot;,
                        &quot;PasswordLength&quot;: 16,
                        &quot;ExcludeCharacters&quot;: &quot;\&quot;@/\\&quot;
                    },
                    &quot;Tags&quot;: [
                        <span>{</span>
                            &quot;Key&quot;: &quot;AppName&quot;,
                            &quot;Value&quot;: &quot;MyApp&quot;
                        }
                    ]
                }
            },
            &quot;MyDBInstance&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::RDS::DBInstance&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;AllocatedStorage&quot;: 20,
                    &quot;DBInstanceClass&quot;: &quot;db.t3.micro&quot;,
                    &quot;Engine&quot;: &quot;mysql&quot;,
                    &quot;DBSubnetGroupName&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDBSubnetGroup&quot;
                    },
                    &quot;MasterUsername&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRDSInstanceRotationSecret}::username}}&quot;
                    },
                    &quot;MasterUserPassword&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRDSInstanceRotationSecret}::password}}&quot;
                    },
                    &quot;BackupRetentionPeriod&quot;: 0,
                    &quot;VPCSecurityGroups&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ]
                }
            },
            &quot;MyDBSubnetGroup&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::RDS::DBSubnetGroup&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;DBSubnetGroupDescription&quot;: &quot;Test Group&quot;,
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ]
                }
            },
            &quot;SecretRDSInstanceAttachment&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyRDSInstanceRotationSecret&quot;
                    },
                    &quot;TargetId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDBInstance&quot;
                    },
                    &quot;TargetType&quot;: &quot;AWS::RDS::DBInstance&quot;
                }
            },
            &quot;MySecretRotationSchedule&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::RotationSchedule&quot;,
                &quot;DependsOn&quot;: &quot;SecretRDSInstanceAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyRDSInstanceRotationSecret&quot;
                    },
                    &quot;HostedRotationLambda&quot;: <span>{</span>
                        &quot;RotationType&quot;: &quot;MySQLSingleUser&quot;,
                        &quot;RotationLambdaName&quot;: &quot;SecretsManagerRotation&quot;,
                        &quot;VpcSecurityGroupIds&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        },
                        &quot;VpcSubnetIds&quot;: <span>{</span>
                            &quot;Fn::Join&quot;: [
                                &quot;,&quot;,
                                [
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet01&quot;
                                    },
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet02&quot;
                                    }
                                ]
                            ]
                        }
                    },
                    &quot;RotationRules&quot;: <span>{</span>
                        &quot;AutomaticallyAfterDays&quot;: 30
                    }
                }
            }
        }
    }</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--Configuring_RDS_DB_Secret_Rotation--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "> AWSTemplateFormatVersion: 2010-09-09
 Transform: AWS::SecretsManager-2020-07-23
 Description: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot;
 Resources:

      #This is the VPC that the rotation Lambda and the RDS instance will be placed in
      TestVPC: 
        Type: AWS::EC2::VPC
        Properties: 
          CidrBlock: 10.0.0.0/16
          EnableDnsHostnames: true
          EnableDnsSupport: true 

      # Subnet that the rotation Lambda and the RDS instance will be placed in 
      TestSubnet01:
        Type: AWS::EC2::Subnet
        Properties:
          CidrBlock: 10.0.96.0/19
          AvailabilityZone:
            Fn::Select:
              - &apos;0&apos;
              - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
          VpcId:
            Ref: TestVPC

      TestSubnet02:
        Type: AWS::EC2::Subnet
        Properties:
          CidrBlock: 10.0.128.0/19
          AvailabilityZone:
            Fn::Select:
              - &apos;1&apos;
              - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
          VpcId:
            Ref: TestVPC

      #VPC endpoint that will enable the rotation Lambda to make api calls to Secrets Manager 
      SecretsManagerVPCEndpoint:
        Type: AWS::EC2::VPCEndpoint
        Properties:
          SubnetIds:
            - Ref: TestSubnet01
            - Ref: TestSubnet02
          SecurityGroupIds:
            - !GetAtt TestVPC.DefaultSecurityGroup
          VpcEndpointType: &apos;Interface&apos;
          ServiceName: !Sub &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
          PrivateDnsEnabled: true
          VpcId:
            Ref: TestVPC

      #This is a Secret resource with a randomly generated password in its SecretString JSON.
      MyRDSInstanceRotationSecret:
        Type: AWS::SecretsManager::Secret
        Properties:
          Description: &apos;This is my rds instance secret&apos;
          GenerateSecretString:
            SecretStringTemplate: &apos;<span>{</span>&quot;username&quot;: &quot;admin&quot;}&apos;
            GenerateStringKey: &apos;password&apos;
            PasswordLength: 16
            ExcludeCharacters: &apos;&quot;@/\&apos;
          Tags:
            -
              Key: AppName
              Value: MyApp

      #This is an RDS instance resource. Its master username and password use dynamic references to resolve values from 
      #SecretsManager. The dynamic reference guarantees that CloudFormation will not log or persist the resolved value 
      #We sub the Secret resource&apos;s logical id in order to construct the dynamic reference, since the Secret&apos;s name is being #generated by CloudFormation
      MyDBInstance:
        Type: AWS::RDS::DBInstance
        Properties:
          AllocatedStorage: 20
          DBInstanceClass: db.t3.micro
          Engine: mysql
          DBSubnetGroupName:
            Ref: MyDBSubnetGroup
          MasterUsername: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRDSInstanceRotationSecret}::username}}&apos;
          MasterUserPassword: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRDSInstanceRotationSecret}::password}}&apos;
          BackupRetentionPeriod: 0
          VPCSecurityGroups:
            - !GetAtt TestVPC.DefaultSecurityGroup

      #Database subnet group for the RDS instance 
      MyDBSubnetGroup: 
        Type: AWS::RDS::DBSubnetGroup
        Properties: 
          DBSubnetGroupDescription: &quot;Test Group&quot;
          SubnetIds: 
             - Ref: TestSubnet01
             - Ref: TestSubnet02
    
      #This is a SecretTargetAttachment resource which updates the referenced Secret resource with properties about
      #the referenced RDS instance
      SecretRDSInstanceAttachment:
        Type: AWS::SecretsManager::SecretTargetAttachment
        Properties:
          SecretId: !Ref MyRDSRotationSecret
          TargetId: !Ref MyDBInstance
          TargetType: AWS::RDS::DBInstance
     
      #This is a RotationSchedule resource. It configures rotation of password for the referenced secret using a rotation lambda
      #The first rotation happens at resource creation time, with subsequent rotations scheduled according to the rotation rules
      #We explicitly depend on the SecretTargetAttachment resource being created to ensure that the secret contains all the
      #information necessary for rotation to succeed
      MySecretRotationSchedule:
        Type: AWS::SecretsManager::RotationSchedule
        DependsOn: SecretRDSInstanceAttachment 
        Properties:
          SecretId: !Ref MyRDSInstanceRotationSecret
          HostedRotationLambda:
            RotationType: MySQLSingleUser
            RotationLambdaName: SecretsManagerRotation
            VpcSecurityGroupIds: !GetAtt TestVPC.DefaultSecurityGroup
            VpcSubnetIds:
              Fn::Join:
                - &quot;,&quot;
                - - Ref: TestSubnet01
                  - Ref: TestSubnet02
          RotationRules:
            AutomaticallyAfterDays: 30</code></pre></div>
                                 <h3 id="aws-resource-secretsmanager-rotationschedule--examples--Redshift_Cluster_Secret_Rotation_Example">Redshift Cluster Secret Rotation Example</h3>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--Redshift_Cluster_Secret_Rotation_Example--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
        &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
        &quot;Transform&quot;: &quot;AWS::SecretsManager-2020-07-23&quot;,
        &quot;Description&quot;: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot;,
        &quot;Resources&quot;: <span>{</span>
            &quot;TestVPC&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPC&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.0.0/16&quot;,
                    &quot;EnableDnsHostnames&quot;: true,
                    &quot;EnableDnsSupport&quot;: true
                }
            },
            &quot;TestSubnet01&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.96.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;0&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;TestSubnet02&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.128.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;1&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;SecretsManagerVPCEndpoint&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPCEndpoint&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ],
                    &quot;SecurityGroupIds&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ],
                    &quot;VpcEndpointType&quot;: &quot;Interface&quot;,
                    &quot;ServiceName&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
                    },
                    &quot;PrivateDnsEnabled&quot;: true,
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;MyRedshiftSecret&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::Secret&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;Description&quot;: &quot;This is my rds instance secret&quot;,
                    &quot;GenerateSecretString&quot;: <span>{</span>
                        &quot;SecretStringTemplate&quot;: &quot;<span>{</span>\&quot;username\&quot;: \&quot;admin\&quot;}&quot;,
                        &quot;GenerateStringKey&quot;: &quot;password&quot;,
                        &quot;PasswordLength&quot;: 16,
                        &quot;ExcludeCharacters&quot;: &quot;\&quot;@/\\&quot;
                    },
                    &quot;Tags&quot;: [
                        <span>{</span>
                            &quot;Key&quot;: &quot;AppName&quot;,
                            &quot;Value&quot;: &quot;MyApp&quot;
                        }
                    ]
                }
            },
            &quot;MyRedshiftCluster&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::Redshift::Cluster&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;DBName&quot;: &quot;myyamldb&quot;,
                    &quot;NodeType&quot;: &quot;ds2.xlarge&quot;,
                    &quot;ClusterType&quot;: &quot;single-node&quot;,
                    &quot;ClusterSubnetGroupName&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;ResdshiftSubnetGroup&quot;
                    },
                    &quot;MasterUsername&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::username}}&quot;
                    },
                    &quot;MasterUserPassword&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::password}}&quot;
                    },
                    &quot;PubliclyAccessible&quot;: false,
                    &quot;VpcSecurityGroupIds&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ]
                }
            },
            &quot;ResdshiftSubnetGroup&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::Redshift::ClusterSubnetGroup&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;Description&quot;: &quot;Test Group&quot;,
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ]
                }
            },
            &quot;SecretRedshiftAttachment&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyRedshiftSecret&quot;
                    },
                    &quot;TargetId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyRedshiftCluster&quot;
                    },
                    &quot;TargetType&quot;: &quot;AWS::Redshift::Cluster&quot;
                }
            },
            &quot;MySecretRotationSchedule&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::RotationSchedule&quot;,
                &quot;DependsOn&quot;: &quot;SecretRedshiftAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyRedshiftSecret&quot;
                    },
                    &quot;HostedRotationLambda&quot;: <span>{</span>
                        &quot;RotationType&quot;: &quot;RedshiftSingleUser&quot;,
                        &quot;RotationLambdaName&quot;: &quot;SecretsManagerRotationRedshift&quot;,
                        &quot;VpcSecurityGroupIds&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        },
                        &quot;VpcSubnetIds&quot;: <span>{</span>
                            &quot;Fn::Join&quot;: [
                                &quot;,&quot;,
                                [
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet01&quot;
                                    },
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet02&quot;
                                    }
                                ]
                            ]
                        }
                    },
                    &quot;RotationRules&quot;: <span>{</span>
                        &quot;AutomaticallyAfterDays&quot;: 30
                    }
                }
            }
        }
    }</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--Redshift_Cluster_Secret_Rotation_Example--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::SecretsManager-2020-07-23
Description: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot; 
Resources:

      #This is the VPC that the rotation Lambda and the Redshift cluster will be placed in 
      TestVPC: 
        Type: AWS::EC2::VPC
        Properties: 
          CidrBlock: 10.0.0.0/16
          EnableDnsHostnames: true
          EnableDnsSupport: true 

      # Subnet that the rotation Lambda and the Redshift cluster will be placed in 
      TestSubnet01:
        Type: AWS::EC2::Subnet
        Properties:
          CidrBlock: 10.0.96.0/19
          AvailabilityZone:
            Fn::Select:
              - &apos;0&apos;
              - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
          VpcId:
            Ref: TestVPC

      TestSubnet02:
        Type: AWS::EC2::Subnet
        Properties:
          CidrBlock: 10.0.128.0/19
          AvailabilityZone:
            Fn::Select:
              - &apos;1&apos;
              - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
          VpcId:
            Ref: TestVPC

      #VPC endpoint that will enable the rotation Lambda to make api calls to Secrets Manager 
      SecretsManagerVPCEndpoint:
        Type: AWS::EC2::VPCEndpoint
        Properties:
          SubnetIds:
            - Ref: TestSubnet01
            - Ref: TestSubnet02
          SecurityGroupIds:
            - !GetAtt TestVPC.DefaultSecurityGroup
          VpcEndpointType: &apos;Interface&apos;
          ServiceName: !Sub &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
          PrivateDnsEnabled: true
          VpcId:
            Ref: TestVPC

      #This is a Secret resource with a randomly generated password in its SecretString JSON.
      MyRedshiftSecret:
        Type: AWS::SecretsManager::Secret
        Properties:
          Description: &apos;This is my rds instance secret&apos;
          GenerateSecretString:
            SecretStringTemplate: &apos;<span>{</span>&quot;username&quot;: &quot;admin&quot;}&apos;
            GenerateStringKey: &apos;password&apos;
            PasswordLength: 16
            ExcludeCharacters: &apos;&quot;@/\&apos;
          Tags:
            -
              Key: AppName
              Value: MyApp
     
      # This is a Redshift cluster resource. The master username and password use dynamic references
      # to resolve values from Secrets Manager. The dynamic reference guarantees that CloudFormation 
      # will not log or persist the resolved value. We use a Ref to the secret resource&apos;s logical id
      # to construct the dynamic reference, since the secret name is generated by CloudFormation. 
      MyRedshiftCluster:
        Type: AWS::Redshift::Cluster
        Properties:
          DBName: &quot;myyamldb&quot;
          NodeType: &quot;ds2.xlarge&quot;
          ClusterType: &quot;single-node&quot;
          ClusterSubnetGroupName:
            Ref: ResdshiftSubnetGroup
          MasterUsername: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::username}}&apos;
          MasterUserPassword: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyRedshiftSecret}::password}}&apos;
          PubliclyAccessible: false
          VpcSecurityGroupIds:
            - !GetAtt TestVPC.DefaultSecurityGroup

      #Database subnet group for the Redshift cluster 
      ResdshiftSubnetGroup: 
        Type: AWS::Redshift::ClusterSubnetGroup
        Properties: 
          Description: &quot;Test Group&quot;
          SubnetIds: 
             - Ref: TestSubnet01
             - Ref: TestSubnet02
    
      # This is a SecretTargetAttachment resource which updates the referenced Secret resource with properties about 
      # the referenced Redshift cluster
      SecretRedshiftAttachment:
        Type: AWS::SecretsManager::SecretTargetAttachment
        Properties:
          SecretId: !Ref MyRedshiftSecret
          TargetId: !Ref MyRedshiftCluster
          TargetType: AWS::Redshift::Cluster
     
      #This is a RotationSchedule resource. It configures rotation of password for the referenced secret using a rotation lambda
      #The first rotation happens at resource creation time, with subsequent rotations scheduled according to the rotation rules
      #We explicitly depend on the SecretTargetAttachment resource being created to ensure that the secret contains all the
      #information necessary for rotation to succeed
      MySecretRotationSchedule:
        Type: AWS::SecretsManager::RotationSchedule
        DependsOn: SecretRedshiftAttachment
        Properties:
          SecretId: !Ref MyRedshiftSecret
          HostedRotationLambda:
            RotationType: RedshiftSingleUser
            RotationLambdaName: SecretsManagerRotationRedshift
            VpcSecurityGroupIds: !GetAtt TestVPC.DefaultSecurityGroup
            VpcSubnetIds:
              Fn::Join:
                - &quot;,&quot;
                - - Ref: TestSubnet01
                  - Ref: TestSubnet02
          RotationRules:
            AutomaticallyAfterDays: 30</code></pre></div>
                                 <h3 id="aws-resource-secretsmanager-rotationschedule--examples--DocumentDB_Cluster_Secret_Rotation_Example">DocumentDB Cluster Secret Rotation Example</h3>
                                 <div id="JSON" name="JSON" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--DocumentDB_Cluster_Secret_Rotation_Example--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
        &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
        &quot;Transform&quot;: &quot;AWS::SecretsManager-2020-07-23&quot;,
        &quot;Description&quot;: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot;,
        &quot;Resources&quot;: <span>{</span>
            &quot;TestVPC&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPC&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.0.0/16&quot;,
                    &quot;EnableDnsHostnames&quot;: true,
                    &quot;EnableDnsSupport&quot;: true
                }
            },
            &quot;TestSubnet01&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.96.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;0&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;TestSubnet02&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::Subnet&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;CidrBlock&quot;: &quot;10.0.128.0/19&quot;,
                    &quot;AvailabilityZone&quot;: <span>{</span>
                        &quot;Fn::Select&quot;: [
                            &quot;1&quot;,
                            <span>{</span>
                                &quot;Fn::GetAZs&quot;: <span>{</span>
                                    &quot;Ref&quot;: &quot;AWS::Region&quot;
                                }
                            }
                        ]
                    },
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;SecretsManagerVPCEndpoint&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::EC2::VPCEndpoint&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ],
                    &quot;SecurityGroupIds&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ],
                    &quot;VpcEndpointType&quot;: &quot;Interface&quot;,
                    &quot;ServiceName&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
                    },
                    &quot;PrivateDnsEnabled&quot;: true,
                    &quot;VpcId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;TestVPC&quot;
                    }
                }
            },
            &quot;MyDocDBClusterRotationSecret&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::Secret&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;Description&quot;: &quot;This is my rds instance secret&quot;,
                    &quot;GenerateSecretString&quot;: <span>{</span>
                        &quot;SecretStringTemplate&quot;: &quot;<span>{</span>\&quot;username\&quot;: \&quot;someadmin\&quot;, \&quot;ssl\&quot;: true}&quot;,
                        &quot;GenerateStringKey&quot;: &quot;password&quot;,
                        &quot;PasswordLength&quot;: 16,
                        &quot;ExcludeCharacters&quot;: &quot;\&quot;@/\\&quot;
                    },
                    &quot;Tags&quot;: [
                        <span>{</span>
                            &quot;Key&quot;: &quot;AppName&quot;,
                            &quot;Value&quot;: &quot;MyApp&quot;
                        }
                    ]
                }
            },
            &quot;MyDocDBCluster&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::DocDB::DBCluster&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;DBSubnetGroupName&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDBSubnetGroup&quot;
                    },
                    &quot;MasterUsername&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyDocDBClusterRotationSecret}::username}}&quot;
                    },
                    &quot;MasterUserPassword&quot;: <span>{</span>
                        &quot;Fn::Sub&quot;: &quot;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyDocDBClusterRotationSecret}::password}}&quot;
                    },
                    &quot;VpcSecurityGroupIds&quot;: [
                        <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        }
                    ]
                }
            },
            &quot;DocDBInstance&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::DocDB::DBInstance&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;DBClusterIdentifier&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDocDBCluster&quot;
                    },
                    &quot;DBInstanceClass&quot;: &quot;db.r5.large&quot;
                }
            },
            &quot;MyDBSubnetGroup&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::DocDB::DBSubnetGroup&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;DBSubnetGroupDescription&quot;: &quot;Test Group&quot;,
                    &quot;SubnetIds&quot;: [
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet01&quot;
                        },
                        <span>{</span>
                            &quot;Ref&quot;: &quot;TestSubnet02&quot;
                        }
                    ]
                }
            },
            &quot;SecretDocDBClusterAttachment&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::SecretTargetAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDocDBClusterRotationSecret&quot;
                    },
                    &quot;TargetId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDocDBCluster&quot;
                    },
                    &quot;TargetType&quot;: &quot;AWS::DocDB::DBCluster&quot;
                }
            },
            &quot;MySecretRotationSchedule&quot;: <span>{</span>
                &quot;Type&quot;: &quot;AWS::SecretsManager::RotationSchedule&quot;,
                &quot;DependsOn&quot;: &quot;SecretDocDBClusterAttachment&quot;,
                &quot;Properties&quot;: <span>{</span>
                    &quot;SecretId&quot;: <span>{</span>
                        &quot;Ref&quot;: &quot;MyDocDBClusterRotationSecret&quot;
                    },
                    &quot;HostedRotationLambda&quot;: <span>{</span>
                        &quot;RotationType&quot;: &quot;MongoDBSingleUser&quot;,
                        &quot;RotationLambdaName&quot;: &quot;MongoDBSingleUser&quot;,
                        &quot;VpcSecurityGroupIds&quot;: <span>{</span>
                            &quot;Fn::GetAtt&quot;: [
                                &quot;TestVPC&quot;,
                                &quot;DefaultSecurityGroup&quot;
                            ]
                        },
                        &quot;VpcSubnetIds&quot;: <span>{</span>
                            &quot;Fn::Join&quot;: [
                                &quot;,&quot;,
                                [
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet01&quot;
                                    },
                                    <span>{</span>
                                        &quot;Ref&quot;: &quot;TestSubnet02&quot;
                                    }
                                ]
                            ]
                        }
                    },
                    &quot;RotationRules&quot;: <span>{</span>
                        &quot;AutomaticallyAfterDays&quot;: 30
                    }
                }
            }
        }
    }</code></pre></div>
                                 <div id="YAML" name="YAML" class="section langfilter">
                                    <h4 id="aws-resource-secretsmanager-rotationschedule--examples--DocumentDB_Cluster_Secret_Rotation_Example--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "> 
        Transform: AWS::SecretsManager-2020-07-23
        Description: &quot;This is an example template to demonstrate CloudFormation resources for Secrets Manager&quot;
        Resources:
        
        #This is the VPC that the rotation Lambda and the DocDB cluster will be placed in 
        TestVPC: 
        Type: AWS::EC2::VPC
        Properties: 
        CidrBlock: 10.0.0.0/16
        EnableDnsHostnames: true
        EnableDnsSupport: true 
        
        # Subnet that the rotation Lambda and the DocDB cluster will be placed in 
        TestSubnet01:
        Type: AWS::EC2::Subnet
        Properties:
        CidrBlock: 10.0.96.0/19
        AvailabilityZone:
        Fn::Select:
        - &apos;0&apos;
        - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
        VpcId:
        Ref: TestVPC
        
        TestSubnet02:
        Type: AWS::EC2::Subnet
        Properties:
        CidrBlock: 10.0.128.0/19
        AvailabilityZone:
        Fn::Select:
        - &apos;1&apos;
        - Fn::GetAZs: <span>{</span>Ref: &apos;AWS::Region&apos;}
        VpcId:
        Ref: TestVPC
        
        #VPC endpoint that will enable the rotation Lambda to make api calls to Secrets Manager 
        SecretsManagerVPCEndpoint:
        Type: AWS::EC2::VPCEndpoint
        Properties:
        SubnetIds:
        - Ref: TestSubnet01
        - Ref: TestSubnet02
        SecurityGroupIds:
        - !GetAtt TestVPC.DefaultSecurityGroup
        VpcEndpointType: &apos;Interface&apos;
        ServiceName: !Sub &quot;com.amazonaws.$<span>{</span>AWS::Region}.secretsmanager&quot;
        PrivateDnsEnabled: true
        VpcId:
        Ref: TestVPC
        
        #This is a Secret resource with a randomly generated password in its SecretString JSON.
        MyDocDBClusterRotationSecret:
        Type: AWS::SecretsManager::Secret
        Properties:
        Description: &apos;This is my rds instance secret&apos;
        GenerateSecretString:
        SecretStringTemplate: &apos;<span>{</span>&quot;username&quot;: &quot;someadmin&quot;, &quot;ssl&quot;: true}&apos;
        GenerateStringKey: &apos;password&apos;
        PasswordLength: 16
        ExcludeCharacters: &apos;&quot;@/\&apos;
        Tags:
        -
        Key: AppName
        Value: MyApp
        
        #This is an DocDB cluster resource. Its master username and password use dynamic references to resolve values from 
        #SecretsManager. The dynamic reference guarantees that CloudFormation will not log or persist the resolved value
        #We sub the Secret resource&apos;s logical id in order to construct the dynamic reference, since the Secret&apos;s name is being #generated by CloudFormation
        MyDocDBCluster:
        Type: AWS::DocDB::DBCluster
        Properties:
        DBSubnetGroupName:
        Ref: MyDBSubnetGroup 
        MasterUsername: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyDocDBClusterRotationSecret}::username}}&apos;
        MasterUserPassword: !Sub &apos;<span>{</span><span>{</span>resolve:secretsmanager:$<span>{</span>MyDocDBClusterRotationSecret}::password}}&apos;
        VpcSecurityGroupIds:
        - !GetAtt TestVPC.DefaultSecurityGroup
        
        DocDBInstance:
        Type: AWS::DocDB::DBInstance
        Properties:
        DBClusterIdentifier: !Ref MyDocDBCluster
        DBInstanceClass: &quot;db.r5.large&quot; 
        
        #Database subnet group for the DocDB cluster 
        MyDBSubnetGroup: 
        Type: AWS::DocDB::DBSubnetGroup
        Properties: 
        DBSubnetGroupDescription: &quot;Test Group&quot;
        SubnetIds: 
        - Ref: TestSubnet01
        - Ref: TestSubnet02
        
        #This is a SecretTargetAttachment resource which updates the referenced Secret resource with properties about
        #the referenced DocDB cluster
        SecretDocDBClusterAttachment:
        Type: AWS::SecretsManager::SecretTargetAttachment
        Properties:
        SecretId: !Ref MyDocDBClusterRotationSecret
        TargetId: !Ref MyDocDBCluster
        TargetType: AWS::DocDB::DBCluster
        
        #This is a RotationSchedule resource. It configures rotation of password for the referenced secret using a rotation lambda
        #The first rotation happens at resource creation time, with subsequent rotations scheduled according to the rotation rules
        #We explicitly depend on the SecretTargetAttachment resource being created to ensure that the secret contains all the
        #information necessary for rotation to succeed
        MySecretRotationSchedule:
        Type: AWS::SecretsManager::RotationSchedule
        DependsOn: SecretDocDBClusterAttachment
        DependsOn: DocDBInstance
        Properties:
        SecretId: !Ref MyDocDBClusterRotationSecret
        HostedRotationLambda:
        RotationType: MongoDBSingleUser
        RotationLambdaName: MongoDBSingleUser
        VpcSecurityGroupIds: !GetAtt TestVPC.DefaultSecurityGroup
        VpcSubnetIds:
        Fn::Join:
        - &quot;,&quot;
        - - Ref: TestSubnet01
        - Ref: TestSubnet02
        RotationRules:
        AutomaticallyAfterDays: 30
    </code></pre></div>
                                 <h2 id="aws-resource-secretsmanager-rotationschedule--seealso">See also</h2>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>
                                             <a href="https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_RotateSecret.html">RotateSecret</a> in
                                             the AWS Secrets Manager API Reference
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>
                                             <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html">Rotating Your AWS Secrets Manager Secrets</a> in the AWS Secrets Manager User
                                             Guide
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          <p><a href="aws-properties-secretsmanager-rotationschedule-hostedrotationlambda.html">AWS::SecretsManager::RotationSchedule HostedRotationLambda</a></p>
                                       </li>
                                    </ul>
                                 </div>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning"> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser&apos;s Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div></div>
</body>
</html>